!function(){"use strict";var e=angular.module("xsound",[]);e.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|data|blob):/)}]),e.factory("BASE_URL",["$location",function(e){return"localhost"===e.host()?e.protocol()+"://"+e.host()+"/~rilakkuma3xjapan/GitHub/X-Sound/resources/":e.protocol()+"://"+e.host()+"/X-Sound/resources/"}]),e.value("sources",["mixer","oscillator","oneshot","audio","stream","noise"]),e.value("oscillatorNumbers",[0,1,2,3]),e.value("updateParamEachOscillator",function(e,a,t,r,o){switch(a){case 0:t?angular.forEach(e,function(e){X("oscillator",e).module(t).param(r,o)}):angular.forEach(e,function(e){X("oscillator",e).param(r,o)});break;case 1:t?angular.forEach(e,function(e){C("oscillator",e).module(t).param(r,o)}):angular.forEach(e,function(e){C("oscillator",e).param(r,o)})}}),e.value("updateParamOfModule",function(e,a,t,r){"oscillator"===e&&"envelopegenerator"===a?(X("oscillator").module("envelopegenerator").param(t,r),C("oscillator").module("envelopegenerator").param(t,r)):"analyser"===a&&"interval"===t?0<r?(X(e).module("analyser").domain("time").param("interval",r),X(e).module("analyser").domain("fft").param("interval",r)):(X(e).module("analyser").domain("time").param("interval","auto"),X(e).module("analyser").domain("fft").param("interval","auto")):(X(e).module(a).param(t,r),"oscillator"===e&&C("oscillator").module(a).param(t,r))}),e.value("updateParamOfSource",function(e,a,t){"oneshot"===e&&"playbackRate"===a?X("oneshot").param("transpose",t):(X(e).param(a,t),C("oscillator").param(a,t))}),e.factory("updateParam",["oscillatorNumbers","updateParamEachOscillator","updateParamOfModule","updateParamOfSource",function(i,s,n,l){return function(e,t,r,o){var a=[];a=e?e.split(" "):["mixer","oscillator","oneshot","audio","stream","noise"],angular.forEach(a,function(e){var a=e.match(/oscillator(0|1)/);null!==a?s(i,parseInt(a[1]),t,r,o):t?n(e,t,r,o):l(e,r,o)})}}]),e.value("openDialog",function(e,a,t,r,o){$("<div />").html(o).dialog({title:e,autoOpen:!0,show:"explode",hide:"explode",width:a,height:t,modal:r,draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){$(this).dialog("close").dialog("destroy").remove()}}})}),e.factory("readFile",["openDialog",function(t){return function(e){var a=null;try{a=X.file(e)}catch(e){t("Error",500,"auto",!0,"<p><b>"+e.message+"</b></p>")}return a}}]),e.factory("readFileByDragAndDrop",["readFile",function(r){return function(e,t){e.addEventListener("dragenter",function(e){e.preventDefault(),$(this).removeClass("drag-off").addClass("drag-on")}),e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("dragleave",function(e){$(this).removeClass("drag-on").addClass("drag-off")}),e.addEventListener("drop",function(e){$(this).removeClass("drag-on").addClass("drag-off"),t.event=e;var a=r(t);a instanceof Blob&&(this.value=a.name)})}}]),e.factory("readFileErrorCallback",["openDialog",function(t){return function(e){var a="";switch(e){case"FILE_IS_NOT_BLOB":a="The designated file is not Blob";break;case"NOT_FOUND_ERR":a="There is not file";break;case"SECURITY_ERR":a="Security error occurred";break;case"ABORT_ERR":a="Abort";break;case"NOT_READABLE_ERR":a="The authority to read file does not exists";break;case"ENCODING_ERR":a="FIle size exceeds limit";break;case"ERR":a="Error. Please try again."}t("Error",500,"auto",!0,"<p><b>"+a+"</b></p>")}}]),e.value("readFileProgressCallback",function(e,a,t){var r=0,o="";t.lengthComputable&&0<t.total&&(r=Math.floor(t.loaded/t.total*100),o=t.loaded+" Bytes load ("+r+" %)",a(function(){e.readFileProgress=o,e.isModalProgressReadFile||(e.isModalProgressReadFile=!0)}))}),e.factory("drawNodeCallback",["$rootScope",function(t){return function(e,a){0<=a&&a<=X("audio").param("duration")&&(X("audio").param("currentTime",a),X("audio").module("analyser").domain("time-overview-L").update(a),X("audio").module("analyser").domain("time-overview-R").update(a),e(function(){t.currentTime=a}))}}]),e.value("createTimeString",function(e){var a=X.convertTime(e);return 0===a.milliseconds?("0"+a.minutes).slice(-2)+" : "+("0"+a.seconds).slice(-2)+".00":("0"+a.minutes).slice(-2)+" : "+("0"+a.seconds).slice(-2)+"."+String(a.milliseconds).slice(2,4)}),e.value("createDateTimeString",function(){var e=function(e){return("0"+e).slice(-2)},a=new Date;return a.getFullYear()+e(a.getMonth()+1)+e(a.getDate())+e(a.getHours())+e(a.getMinutes())+e(a.getSeconds())}),e.value("getCurrentPatches",function(){return{mastervolume:X("oscillator").params().mastervolume,glide:{type:X("oscillator").params().oscillator.glide.type,time:X("oscillator").params().oscillator.glide.time},oscillator0:X("oscillator").params().oscillator.oscillator0,oscillator1:C("oscillator").params().oscillator.oscillator0,envelopegenerator:{attack:X("oscillator").params().envelopegenerator.attack,decay:X("oscillator").params().envelopegenerator.decay,sustain:X("oscillator").params().envelopegenerator.sustain,release:X("oscillator").params().envelopegenerator.release},compressor:{state:X("oscillator").params().compressor.state,threshold:X("oscillator").params().compressor.threshold,knee:X("oscillator").params().compressor.knee,ratio:X("oscillator").params().compressor.ratio,attack:X("oscillator").params().compressor.attack,release:X("oscillator").params().compressor.release},distortion:{state:X("oscillator").params().distortion.state,curve:X("oscillator").params().distortion.curve,samples:X("oscillator").params().distortion.samples,drive:X("oscillator").params().distortion.drive,color:X("oscillator").params().distortion.color,tone:X("oscillator").params().distortion.tone},wah:{state:X("oscillator").params().wah.state,cutoff:X("oscillator").params().wah.cutoff,depth:X("oscillator").params().wah.depth,rate:X("oscillator").params().wah.rate,resonance:X("oscillator").params().wah.resonance},equalizer:{state:X("oscillator").params().equalizer.state,bass:X("oscillator").params().equalizer.bass,middle:X("oscillator").params().equalizer.middle,treble:X("oscillator").params().equalizer.treble,presence:X("oscillator").params().equalizer.presence},filter:{state:X("oscillator").params().filter.state,type:X("oscillator").params().filter.type,frequency:X("oscillator").params().filter.frequency,Q:X("oscillator").params().filter.Q,gain:X("oscillator").params().filter.gain,attack:X("oscillator").params().filter.attack,decay:X("oscillator").params().filter.decay,sustain:X("oscillator").params().filter.sustain,release:X("oscillator").params().filter.release},autopanner:{state:X("oscillator").params().autopanner.state,depth:X("oscillator").params().autopanner.depth,rate:X("oscillator").params().autopanner.rate},tremolo:{state:X("oscillator").params().tremolo.state,depth:X("oscillator").params().tremolo.depth,rate:X("oscillator").params().tremolo.rate},ringmodulator:{state:X("oscillator").params().ringmodulator.state,depth:X("oscillator").params().ringmodulator.depth,rate:X("oscillator").params().ringmodulator.rate},phaser:{state:X("oscillator").params().phaser.state,stage:X("oscillator").params().phaser.stage,frequency:X("oscillator").params().phaser.frequency,depth:X("oscillator").params().phaser.depth,rate:X("oscillator").params().phaser.rate,mix:X("oscillator").params().phaser.mix,feedback:X("oscillator").params().phaser.feedback},chorus:{state:X("oscillator").params().chorus.state,time:1e3*X("oscillator").params().chorus.time,depth:X("oscillator").params().chorus.depth,rate:X("oscillator").params().chorus.rate,mix:X("oscillator").params().chorus.mix,tone:X("oscillator").params().chorus.tone},flanger:{state:X("oscillator").params().flanger.state,time:1e3*X("oscillator").params().flanger.time,depth:X("oscillator").params().flanger.depth,rate:X("oscillator").params().flanger.rate,mix:X("oscillator").params().flanger.mix,tone:X("oscillator").params().flanger.tone,feedback:X("oscillator").params().flanger.feedback},delay:{state:X("oscillator").params().delay.state,time:1e3*X("oscillator").params().delay.time,dry:X("oscillator").params().delay.dry,wet:X("oscillator").params().delay.wet,tone:X("oscillator").params().delay.tone,feedback:X("oscillator").params().delay.feedback},reverb:{state:X("oscillator").params().reverb.state,dry:X("oscillator").params().reverb.dry,wet:X("oscillator").params().reverb.wet,tone:X("oscillator").params().reverb.tone}}}),e.run(["$rootScope","$window","sources","openDialog",function(e,a,t,r){if(X.IS_XSOUND){e.isActives={visualization:!1,mml:!1,patch:!1},e.currentTime=0,a.C=X.clone(),X.free([X("media")]),C.free([C("oneshot"),C("noise"),C("audio"),C("media"),C("stream"),C("mixer"),C("midi")]),X("mixer").resize(1024),X("oscillator").resize(1024),C("oscillator").resize(1024),X("oneshot").resize(1024),X("audio").resize(8192),X("stream").resize(512),X("oscillator").setup([!0,!0,!0,!0]),C("oscillator").setup([!1,!1,!1,!1]);X("stream").setup({audio:{echoCancellation:!1},video:!1},function(e){},function(e){r("Confirmation",400,"auto",!0,"<p><b>Cancel Microphone.</b></p>")}),angular.forEach(t,function(e){X(e).module("distortion").param("color",2e3),X(e).module("distortion").param("tone",4e3),X(e).module("chorus").param("tone",4e3),X(e).module("flanger").param("tone",4e3),X(e).module("delay").param("tone",4e3),X(e).module("reverb").param("tone",4e3),X(e).module("filter").param("frequency",8e3)}),C("oscillator").module("distortion").param("color",2e3),C("oscillator").module("distortion").param("tone",4e3),C("oscillator").module("chorus").param("tone",4e3),C("oscillator").module("flanger").param("tone",4e3),C("oscillator").module("delay").param("tone",4e3),C("oscillator").module("reverb").param("tone",4e3),C("oscillator").module("filter").param("frequency",8e3);for(var o=0,i=X("oscillator").length();o<i;o++)X("oscillator",o).param("type","sawtooth"),C("oscillator",o).param("type","sawtooth");$("#twitter").socialbutton("twitter",{lang:"en_US"}),$("#facebook").socialbutton("facebook_like",{button:"button_count",locale:"en_US"}),$("#hatena").socialbutton("hatena"),$("#google").socialbutton("google_plusone",{size:"medium"}).width(72)}else r("Error",600,"auto",!0,"<p><b>Your Browser does not support Web Audio API. Please use Chrome, Opera, Firefox (Mac / Windows) or Safari (Mac).</b></p>")}]),e.directive("uiSlider",["updateParam",function(v){return{restrict:"E",template:"<div></div>",link:function(e,a,t,r,o){var i=t.value,s=t.min,n=t.max,l=t.step,c=t.range||"min",u=t.animate||"slow",d=t.source,p=t.module,m=t.param,h=p?p+"-"+m:m,f=function(r){v(d,p,m,r),$(".spinner-"+h).each(function(e,a){var t=$(a).parents("ui-spinner");t.attr("source")===d&&t.attr("module")===p&&("glide"!==p&&"time"===m&&(r*=Math.pow(10,3)),$(a).spinner("value",r))})};$(a).children("div").addClass("slider-"+h).slider({value:parseFloat(i),min:parseFloat(s),max:parseFloat(n),step:parseFloat(l),range:c,animate:u,change:function(e,a){var t=parseFloat(a.value);"glide"!==p&&"time"===m&&(t/=Math.pow(10,3)),f(t)},slide:function(e,a){var t=parseFloat(a.value);"glide"!==p&&"time"===m&&(t/=Math.pow(10,3)),f(t)}})}}}]),e.directive("uiSpinner",["updateParam",function(m){return{restrict:"E",template:"<input />",link:function(e,a,t,r,o){var i=t.value,s=t.min,n=t.max,l=t.step,c=t.source,u=t.module,d=t.param,p=u?u+"-"+d:d;$(a).children("input").addClass("spinner-"+p).spinner({min:parseFloat(s),max:parseFloat(n),step:parseFloat(l),spin:function(e,a){var r,t=parseFloat(a.value);"glide"!==u&&"time"===d&&(t/=Math.pow(10,3)),m(c,u,d,r=t),$(".slider-"+p).each(function(e,a){var t=$(a).parent("ui-slider");t.attr("source")===c&&t.attr("module")===u&&("glide"!==u&&"time"===d&&(r*=Math.pow(10,3)),$(a).slider("value",r))})}}).spinner("value",parseFloat(i))}}}]),e.directive("uiSliderTime",["$rootScope","$timeout","createTimeString",function(u,d,p){return{restrict:"E",template:"<div></div>",link:function(t,e,a,r,o){var i=a.value,s=a.max,n=a.step,l=a.range||"min",c=a.animate||"slow";$(e).children("div").attr("id","slider-audio-current-time").slider({value:parseFloat(i),min:0,max:parseFloat(s),step:parseFloat(n),range:l,animate:c,change:function(e,a){},slide:function(e,a){X("audio").param("currentTime",parseFloat(a.value)),X("audio").module("analyser").domain("time-overview-L").update(X("audio").param("currentTime")),X("audio").module("analyser").domain("time-overview-R").update(X("audio").param("currentTime")),d(function(){u.currentTime=X("audio").param("currentTime")})}}),t.$watch(function(){return t.duration},function(e){$("#slider-audio-current-time").slider("option","max",e),$("#spinner-audio-current-time").spinner("option","max",e)});t.$watch(function(){return u.currentTime},function(e){var a;a=e,$("#slider-audio-current-time").slider("value",a),$("#spinner-audio-current-time").spinner("value",a),t.currentTimeText=p(a)})}}}]),e.directive("uiSpinnerTime",["$rootScope","$timeout",function(l,c){return{restrict:"E",template:"<input />",link:function(e,a,t,r,o){var i=t.value,s=t.max,n=t.step;$(a).children("input").attr("id","spinner-audio-current-time").spinner({min:0,max:parseFloat(s),step:parseFloat(n),spin:function(e,a){X("audio").param("currentTime",parseFloat(a.value)),X("audio").module("analyser").domain("time-overview-L").update(X("audio").param("currentTime")),X("audio").module("analyser").domain("time-overview-R").update(X("audio").param("currentTime")),c(function(){l.currentTime=X("audio").param("currentTime")})}}).spinner("value",parseFloat(i))}}}]),e.directive("uiToggleEffector",["sources",function(n){return{restrict:"A",link:function(e,a,t,r,o){var i=t.effector,s=parseInt(t.state);0!==s&&1!==s||angular.forEach(n,function(e){X(e).module(i).state(Boolean(s)),C("oscillator").module(i).state(Boolean(s)),X(e).module(i).state()?$(a).addClass("check-on"):$(a).removeClass("check-on")}),$(a).on("click",function(){angular.forEach(n,function(e){X(e).module(i).state()?(X(e).module(i).state(!1),C("oscillator").module(i).state(!1),$(a).removeClass("check-on")):(X(e).module(i).state(!0),C("oscillator").module(i).state(!0),$(a).addClass("check-on"))})})}}}]),e.directive("uiModalProgress",["$window",function(i){return{restrict:"E",link:function(e,a,t,r,o){$(a).children("section").css("margin-top",i.innerHeight/2-80+"px")}}}]),e.directive("uiTooltip",function(){return{restrict:"A",link:function(e,a,t,r,o){$(a).tooltip({tooltipClass:"ui-tooltip-custom"})}}}),e.directive("uiSortable",function(){return{restrict:"A",link:function(e,a,t,r,o){$(a).sortable({axis:"x",cancel:"fieldset, :input, button, label, a, #piano",cursor:"move",opacity:.6})}}}),e.directive("uiSelect",["$timeout","sources","openDialog",function(c,o,i){return{restrict:"A",link:function(l,e,a,t,r){switch($(e).select2(),$(e).attr("id")){case"select-sound-source":$(e).on("change",function(){var e=this.value;switch(e){case"oscillator":X("stream").stop(),c(function(){l.currentSoundSource=e,l.selectedSoundSource=e});break;case"piano":case"guitar":l.isEnableOneshot&&c(function(){l.currentSoundSource=e,l.selectedSoundSource=e}),X("stream").stop();break;case"whitenoise":case"pinknoise":case"browniannoise":X("stream").stop(),c(function(){l.currentSoundSource=e,l.selectedSoundSource=e});break;case"stream":try{X("stream").start(),X("stream").module("session").start(),c(function(){l.selectedSoundSource=e})}catch(e){i("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}break;case"midi":X("stream").stop();try{X("midi").setup(!0,function(e,a,t){var s=[],n=[];0<a.length&&(a[0].onmidimessage=function(e){switch(240&e.data[0]){case 144:!function(e,a){if(!(e<21||108<e||a<0||127<a)){var t=e-21,r=a/127;if("oscillator"===l.currentSoundSource){s.push(t),n[0]=X("oscillator",0).param("volume"),n[1]=C("oscillator",0).param("volume");for(var o=0,i=X("oscillator").length();o<i;o++)0!==o&&(X("oscillator",o).state(!0),C("oscillator",o).state(!0)),X("oscillator",o).param("volume",r),C("oscillator",o).param("volume",r);X("oscillator").ready(0,0).start(X.toFrequencies(s)),C("oscillator").ready(0,0).start(X.toFrequencies(s)),X("mixer").mix([X("oscillator"),C("oscillator")]),X("mixer").module("recorder").start(),X("mixer").module("session").start()}else X("oneshot").reset(t,"volume",r).ready(0,0).start(t),X("oneshot").module("recorder").start(),X("oneshot").module("session").start();c(function(){l.isSoundStops[t]=!1})}}(e.data[1],e.data[2]);break;case 128:!function(e,a){if(!(e<21||108<e||a<0||127<a)){var t=e-21;if("oscillator"===l.currentSoundSource){var r=s.indexOf(t);-1!==r&&s.splice(r,1),X("oscillator").stop(),C("oscillator").stop();for(var o=0,i=X("oscillator").length();o<i;o++)0!==o&&(X("oscillator",o).state(!1),C("oscillator",o).state(!1)),X("oscillator",o).param("volume",n[0]),C("oscillator",o).param("volume",n[1])}else X("oneshot").stop(t).reset(t,"volume",1);c(function(){l.isSoundStops[t]=!0})}}(e.data[1],e.data[2])}})},function(e){i("Error",400,"auto",!0,"<p><b>Cannot use Web MIDI API.</b></p>")})}catch(e){i("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}}});break;case"select-rec-track":$(e).on("change",function(){if(!l.isActive){var a=parseInt(this.value);c(function(){l.activeTrack=a}),angular.forEach(o,function(e){"oscillator"!==e&&(X(e).module("recorder").ready(a),"stream"===e&&X("stream").module("recorder").start())})}});break;case"select-visualization-api":$(e).on("change",function(){l.selectAPI(this.value)});break;case"select-distortion-type":$(e).on("change",function(){var a=this.value;angular.forEach(o,function(e){X(e).module("distortion").param("curve",a)})});break;case"select-distortion-sample":$(e).on("change",function(){var a=this.value;angular.forEach(o,function(e){X(e).module("distortion").param("samples",a)})});break;case"select-filter-type":$(e).on("change",function(){var a=this.value;angular.forEach(o,function(e){X(e).module("filter").param("type",a)})});break;case"select-phaser-stage":$(e).on("change",function(){var a=this.value;angular.forEach(o,function(e){X(e).module("phaser").param("stage",a)})});break;case"select-reverb-type":$(e).on("change",function(){var a=parseInt(this.value)-1;-1===a&&(a=null),angular.forEach(o,function(e){X(e).module("reverb").param("type",a)})})}}}}]),e.directive("slideBlock",["$rootScope",function(n){return{restrict:"A",link:function(e,a,t,r,o){var i="easeOutQuint",s=t.model;$(a).hide(),e.$watch(function(){return n.isActives},function(e){e[s]?$(a).slideDown(1e3,i):$(a).slideUp(1e3,i)},!0)}}}]),e.directive("audioUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(l,c,u,d,p){return{restrict:"A",link:function(t,r,e,a,o){var i=r[0],s={event:null,type:"ArrayBuffer",success:function(e,a){X("audio").ready.call(X("audio"),a),l(function(){t.$parent.isModalProgressReadFile=!1})},error:function(e,a){p(a)},progress:function(e){d(t.$parent,l,e)}};i.addEventListener("change",function(e){s.event=e;var a=c(s);this.value="",a instanceof Blob&&$(r).next('[type="text"]').val(a.name)},!1);var n=$(r).next('[type="text"]')[0];u(n,s)}}}]),e.directive("rirUploader",["$timeout","sources","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(l,c,u,d,p,m){return{restrict:"A",link:function(t,r,e,a,o){var i=r[0],s={event:null,type:"ArrayBuffer",success:function(e,a){angular.forEach(c,function(e){X(e).module("reverb").start.call(X(e).module("reverb"),a)}),l(function(){t.isModalProgressReadFile=!1})},error:function(e,a){m(a)},progress:function(e){p(t,l,e)}};i.addEventListener("change",function(e){s.event=e;var a=u(s);this.value="",a instanceof Blob&&$(r).next('[type="text"]').val(a.name)},!1);var n=$(r).next('[type="text"]')[0];d(n,s)}}}]),e.directive("mmlUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(l,c,u,d,p){return{restrict:"A",link:function(r,t,e,a,o){var i=t[0],s={event:null,type:"Text",success:function(e,a){var t=function(){l(function(){r.mml=a,r.paused=!0,r.readyMML()})};""===r.mml?t():$("<div />").html("<p><b>MML already exists. Overwrite ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:500,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){t(),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}}),l(function(){r.$parent.isModalProgressReadFile=!1})},error:function(e,a){p(a)},progress:function(e){d(r.$parent,l,e)}};i.addEventListener("change",function(e){s.event=e;var a=c(s);this.value="",a instanceof Blob&&$(t).next('[type="text"]').val(a.name)},!1);var n=$(t).next('[type="text"]')[0];u(n,s)}}}]),e.controller("XSoundController",["$rootScope","$scope","$window","$timeout","BASE_URL","sources","oscillatorNumbers","openDialog","getCurrentPatches",function(a,r,e,t,o,i,s,n,l){var c,u=!1,d=[o+"one-shot/piano-2/C.wav",o+"one-shot/piano-2/D.wav",o+"one-shot/piano-2/E.wav",o+"one-shot/piano-2/F.wav",o+"one-shot/piano-2/G.wav",o+"one-shot/piano-2/A.wav",o+"one-shot/piano-2/B.wav",o+"one-shot/guitar/C.mp3"],p=function(e){switch(parseInt((e+9)%12)){case 0:case 1:return 0;case 2:case 3:return 1;case 4:return 2;case 5:case 6:return 3;case 7:case 8:return 4;case 9:case 10:return 5;case 11:return 6}},m=function(e){var a=0;switch(e-88){case 0:a=1*Math.pow(Math.pow(2,1/12),-39);break;case 1:a=1*Math.pow(Math.pow(2,1/12),-38);break;case 2:a=1*Math.pow(Math.pow(2,1/12),-37);break;case 3:a=1*Math.pow(Math.pow(2,1/12),-36);break;case 4:a=1*Math.pow(Math.pow(2,1/12),-35);break;case 5:a=1*Math.pow(Math.pow(2,1/12),-34);break;case 6:a=1*Math.pow(Math.pow(2,1/12),-33);break;case 7:a=1*Math.pow(Math.pow(2,1/12),-32);break;case 8:a=1*Math.pow(Math.pow(2,1/12),-31);break;case 9:a=1*Math.pow(Math.pow(2,1/12),-30);break;case 10:a=1*Math.pow(Math.pow(2,1/12),-29);break;case 11:a=1*Math.pow(Math.pow(2,1/12),-28);break;case 12:a=1*Math.pow(Math.pow(2,1/12),-27);break;case 13:a=1*Math.pow(Math.pow(2,1/12),-26);break;case 14:a=1*Math.pow(Math.pow(2,1/12),-25);break;case 15:a=1*Math.pow(Math.pow(2,1/12),-24);break;case 16:a=1*Math.pow(Math.pow(2,1/12),-23);break;case 17:a=1*Math.pow(Math.pow(2,1/12),-22);break;case 18:a=1*Math.pow(Math.pow(2,1/12),-21);break;case 19:a=1*Math.pow(Math.pow(2,1/12),-20);break;case 20:a=1*Math.pow(Math.pow(2,1/12),-19);break;case 21:a=1*Math.pow(Math.pow(2,1/12),-18);break;case 22:a=1*Math.pow(Math.pow(2,1/12),-17);break;case 23:a=1*Math.pow(Math.pow(2,1/12),-16);break;case 24:a=1*Math.pow(Math.pow(2,1/12),-15);break;case 25:a=1*Math.pow(Math.pow(2,1/12),-14);break;case 26:a=1*Math.pow(Math.pow(2,1/12),-13);break;case 27:a=1*Math.pow(Math.pow(2,1/12),-12);break;case 28:a=1*Math.pow(Math.pow(2,1/12),-11);break;case 29:a=1*Math.pow(Math.pow(2,1/12),-10);break;case 30:a=1*Math.pow(Math.pow(2,1/12),-9);break;case 31:a=1*Math.pow(Math.pow(2,1/12),-8);break;case 32:a=1*Math.pow(Math.pow(2,1/12),-7);break;case 33:a=1*Math.pow(Math.pow(2,1/12),-6);break;case 34:a=1*Math.pow(Math.pow(2,1/12),-5);break;case 35:a=1*Math.pow(Math.pow(2,1/12),-4);break;case 36:a=1*Math.pow(Math.pow(2,1/12),-3);break;case 37:a=1*Math.pow(Math.pow(2,1/12),-2);break;case 38:a=1*Math.pow(Math.pow(2,1/12),-1);break;case 39:a=1;break;case 40:a=1*Math.pow(Math.pow(2,1/12),1);break;case 41:a=1*Math.pow(Math.pow(2,1/12),2);break;case 42:a=1*Math.pow(Math.pow(2,1/12),3);break;case 43:a=1*Math.pow(Math.pow(2,1/12),4);break;case 44:a=1*Math.pow(Math.pow(2,1/12),5);break;case 45:a=1*Math.pow(Math.pow(2,1/12),6);break;case 46:a=1*Math.pow(Math.pow(2,1/12),7);break;case 47:a=1*Math.pow(Math.pow(2,1/12),8);break;case 48:a=1*Math.pow(Math.pow(2,1/12),9);break;case 49:a=1*Math.pow(Math.pow(2,1/12),10);break;case 50:a=1*Math.pow(Math.pow(2,1/12),11);break;case 51:a=1*Math.pow(Math.pow(2,1/12),12);break;case 52:a=1*Math.pow(Math.pow(2,1/12),13);break;case 53:a=1*Math.pow(Math.pow(2,1/12),14);break;case 54:a=1*Math.pow(Math.pow(2,1/12),15);break;case 55:a=1*Math.pow(Math.pow(2,1/12),16);break;case 56:a=1*Math.pow(Math.pow(2,1/12),17);break;case 57:a=1*Math.pow(Math.pow(2,1/12),18);break;case 58:a=1*Math.pow(Math.pow(2,1/12),19);break;case 59:a=1*Math.pow(Math.pow(2,1/12),20);break;case 60:a=1*Math.pow(Math.pow(2,1/12),21);break;case 61:a=1*Math.pow(Math.pow(2,1/12),22);break;case 62:a=1*Math.pow(Math.pow(2,1/12),23);break;case 63:a=1*Math.pow(Math.pow(2,1/12),24);break;case 64:a=1*Math.pow(Math.pow(2,1/12),25);break;case 65:a=1*Math.pow(Math.pow(2,1/12),26);break;case 66:a=1*Math.pow(Math.pow(2,1/12),27);break;case 67:a=1*Math.pow(Math.pow(2,1/12),28);break;case 68:a=1*Math.pow(Math.pow(2,1/12),29);break;case 69:a=1*Math.pow(Math.pow(2,1/12),30);break;case 70:a=1*Math.pow(Math.pow(2,1/12),31);break;case 71:a=1*Math.pow(Math.pow(2,1/12),33);break;case 77:a=1*Math.pow(Math.pow(2,1/12),34);break;case 78:a=1*Math.pow(Math.pow(2,1/12),35);break;case 79:a=1*Math.pow(Math.pow(2,1/12),36);break;case 80:a=1*Math.pow(Math.pow(2,1/12),37);break;case 81:a=1*Math.pow(Math.pow(2,1/12),38);break;case 82:a=1*Math.pow(Math.pow(2,1/12),39);break;case 83:a=1*Math.pow(Math.pow(2,1/12),40);break;case 84:a=1*Math.pow(Math.pow(2,1/12),41);break;case 85:a=1*Math.pow(Math.pow(2,1/12),42);break;case 86:a=1*Math.pow(Math.pow(2,1/12),43);break;case 87:a=1*Math.pow(Math.pow(2,1/12),44);break;case 88:a=1*Math.pow(Math.pow(2,1/12),45)}return a},h=function(){t(function(){r.isReady=!0})};try{X("oneshot").setup({resources:d,settings:function(){for(var e,a,t=new Array(88),r=0;r<88;r++)(o={buffer:0,rate:1,loop:!1,start:0,end:0,volume:1}).buffer=p(r),o.rate=(a=void 0,(a=0)<=(e=r)&&e<=2?a=.0625:3<=e&&e<=14?a=.125:15<=e&&e<=26?a=.25:27<=e&&e<=38?a=.5:39<=e&&e<=50?a=1:51<=e&&e<=62?a=2:63<=e&&e<=74?a=4:75<=e&&e<=86?a=8:87<=e&&e<=98&&(a=16),-1!==[1,4,6,9,11,13,16,18,21,23,25,28,30,33,35,37,40,42,45,47,49,52,54,57,59,61,64,66,69,71,73,76,78,81,83,85].indexOf(e)&&(a*=Math.pow(2,1/12)),a),t[r]=o;for(r=88;r<176;r++){var o;(o={buffer:7,rate:1,loop:!1,start:0,end:0,volume:1}).rate=m(r),t[r]=o}return t}(),timeout:6e4,success:function(e,a){var t;r.isEnableOneshot=!0,0===r.rirs.length?h():(t=[],angular.forEach(r.rirs,function(e,a){X.ajax(e.url,6e4,function(e,a){X.decode(X.get(),a,function(e){t.push(e),r.$apply(function(){r.progress=Math.floor(t.length/r.rirs.length*100),r.progressStyle.width=r.progress+"%"}),t.length===r.rirs.length&&(angular.forEach(i,function(e){X(e).module("reverb").preset(t)}),C("oscillator").module("reverb").preset(t),h())},function(e){h()})},function(e,a){n("Error",400,"auto",!0,"<p><b>The loading of RIRs failed.</b></p>")})}))},error:function(e,a){n("Error",400,"auto",!0,"<p><b>The loading of audio files failed.</b></p>")},progress:function(e){}})}catch(e){n("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}r.currentSoundSource="oscillator",r.selectedSoundSource="oscillator",r.isReady=!1,r.progress=0,r.progressStyle={width:r.progress+"%"},r.isSafari=-1===(c=navigator.userAgent.toLowerCase()).indexOf("chrome")&&-1!==c.indexOf("safari"),r.isEnableOneshot=!1,r.isEndOpeing=!1,r.isStart=!1,r.progressWrapperStyle={padding:Math.floor(e.innerHeight/2)-60+"px 0px"},r.headerStyle={top:parseInt(e.innerHeight/4)+"px"},r.isModalProgressDecodeAudio=!1,r.isModalProgressReadFile=!1,r.isModalProgressSessionWait=!1,r.oscillators={},r.oscillators.oscillator0={},r.oscillators.oscillator0.isActive=!0,r.oscillators.oscillator0.type="sawtooth",r.oscillators.oscillator1={},r.oscillators.oscillator1.isActive=!1,r.oscillators.oscillator1.type="sawtooth",r.readFileProgress="",r.rirs=[{url:o+"impulse-responses/s1_r1_c.wav",value:1,label:"1 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s1_r2_c.wav",value:2,label:"1 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s1_r3_c.wav",value:3,label:"1 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s1_r4_c.wav",value:4,label:"1 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s2_r1_c.wav",value:5,label:"2 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s2_r2_c.wav",value:6,label:"2 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s2_r3_c.wav",value:7,label:"2 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s2_r4_c.wav",value:8,label:"2 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s3_r1_c.wav",value:9,label:"3 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s3_r2_c.wav",value:10,label:"3 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s3_r3_c.wav",value:11,label:"3 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s3_r4_c.wav",value:12,label:"3 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s1_r1_o.wav",value:13,label:"1 - 1",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s1_r2_o.wav",value:14,label:"1 - 2",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s1_r3_o.wav",value:15,label:"1 - 3",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s1_r4_o.wav",value:16,label:"1 - 4",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s2_r1_o.wav",value:17,label:"2 - 1",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s2_r2_o.wav",value:18,label:"2 - 2",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s2_r3_o.wav",value:19,label:"2 - 3",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s2_r4_o.wav",value:20,label:"2 - 4",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s3_r1_o.wav",value:21,label:"3 - 1",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s3_r2_o.wav",value:22,label:"3 - 2",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s3_r3_o.wav",value:23,label:"3 - 3",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s3_r4_o.wav",value:24,label:"3 - 4",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s1_p1_o.wav",value:25,label:"1 - 1",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s1_p2_o.wav",value:26,label:"1 - 2",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s1_p3_o.wav",value:27,label:"1 - 3",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s2_p1_o.wav",value:28,label:"2 - 1",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s2_p2_o.wav",value:29,label:"2 - 2",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s2_p3_o.wav",value:30,label:"2 - 3",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s3_p1_o.wav",value:31,label:"3 - 1",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s3_p2_o.wav",value:32,label:"3 - 2",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s3_p3_o.wav",value:33,label:"3 - 3",group:"Omnidirectional measurements on the stage"}],r.pianoKeyboards={},r.pianoKeyboards.keyboards={"A-4":0,"A-4h":1,"B-4":2,"C-3":3,"C-3h":4,"D-3":5,"D-3h":6,"E-3":7,"F-3":8,"F-3h":9,"G-3":10,"G-3h":11,"A-3":12,"A-3h":13,"B-3":14,"C-2":15,"C-2h":16,"D-2":17,"D-2h":18,"E-2":19,"F-2":20,"F-2h":21,"G-2":22,"G-2h":23,"A-2":24,"A-2h":25,"B-2":26,"C-1":27,"C-1h":28,"D-1":29,"D-1h":30,"E-1":31,"F-1":32,"F-1h":33,"G-1":34,"G-1h":35,"A-1":36,"A-1h":37,"B-1":38,C:39,Ch:40,D:41,Dh:42,E:43,F:44,Fh:45,G:46,Gh:47,A:48,Ah:49,B:50,C1:51,C1h:52,D1:53,D1h:54,E1:55,F1:56,F1h:57,G1:58,G1h:59,A1:60,A1h:61,B1:62,C2:63,C2h:64,D2:65,D2h:66,E2:67,F2:68,F2h:69,G2:70,G2h:71,A2:72,A2h:73,B2:74,C3:75,C3h:76,D3:77,D3h:78,E3:79,F3:80,F3h:81,G3:82,G3h:83,A3:84,A3h:85,B3:86,C4:87},r.pianoKeyboards.whites=["A-4","B-4","C-3","D-3","E-3","F-3","G-3","A-3","B-3","C-2","D-2","E-2","F-2","G-2","A-2","B-2","C-1","D-1","E-1","F-1","G-1","A-1","B-1","C","D","E","F","G","A","B","C1","D1","E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4"],r.pianoKeyboards.blacks=["A-4h","skip","C-3h","D-3h","skip","F-3h","G-3h","A-3h","skip","C-2h","D-2h","skip","F-2h","G-2h","A-2h","skip","C-1h","D-1h","skip","F-1h","G-1h","A-1h","skip","Ch","Dh","skip","Fh","Gh","Ah","skip","C1h","D1h","skip","F1h","G1h","A1h","skip","C2h","D2h","skip","F2h","G2h","A2h","skip","C3h","D3h","skip","F3h","G3h","A3h"],r.isSoundStops=[],angular.forEach(r.pianoKeyboards.keyboards,function(){r.isSoundStops.push(!0)}),r.startApplication=function(e){e.preventDefault(),r.isStart=!0,t(function(){r.isEndOpening=!0},2e3)},r.startSound=function(e,a){X.IS_XSOUND&&!$(e.currentTarget).hasClass("skip")&&("mouseover"!==e.type||u)&&("oscillator"===r.currentSoundSource?(X("oscillator").ready(0,0).start(X.toFrequencies(a)),C("oscillator").ready(0,0).start(X.toFrequencies(a)),X("mixer").mix([X("oscillator"),C("oscillator")]),X("mixer").module("recorder").start(),X("mixer").module("session").start()):"piano"===r.currentSoundSource?(X("oneshot").ready(0,0).start(a),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()):"guitar"===r.currentSoundSource?(X("oneshot").ready(0,0).start(a+88),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()):"whitenoise"===r.currentSoundSource?(X("noise").param("type","whitenoise").start(),X("noise").module("recorder").start(),X("noise").module("session").start()):"pinknoise"===r.currentSoundSource?(X("noise").param("type","pinknoise").start(),X("noise").module("recorder").start(),X("noise").module("session").start()):"browniannoise"===r.currentSoundSource&&(X("noise").param("type","browniannoise").start(),X("noise").module("recorder").start(),X("noise").module("session").start()),r.isSoundStops[a]=!1,u=!0)},r.stopSound=function(e,a){X.IS_XSOUND&&!$(e.currentTarget).hasClass("skip")&&(e.stopPropagation(),"oscillator"===r.currentSoundSource?(X("oscillator").stop(),C("oscillator").stop()):"piano"===r.currentSoundSource?X("oneshot").stop(a):"guitar"===r.currentSoundSource?X("oneshot").stop(a+88):X("noise").stop(),r.isSoundStops[a]=!0,"mouseup"===e.type&&(u=!1))},r.clearKeyboards=function(){angular.forEach(r.isSoundStops,function(e,a){r.isSoundStops[a]=!0})},r.toggleOscillatorState=function(e,a){var t=!r.oscillators["oscillator"+a].isActive;switch(a){case 0:angular.forEach([0,1,2,3],function(e){X("oscillator").get(e).state(t)});break;case 1:angular.forEach([0,1,2,3],function(e){C("oscillator").get(e).state(t)})}r.oscillators["oscillator"+a].isActive=t},r.toggleAnalyserState=function(e){a.isActives.visualization=!r.isActives.visualization,angular.forEach(i,function(e){"oscillator"!==e&&(X(e).module("analyser").domain("time").state(a.isActives.visualization),X(e).module("analyser").domain("fft").state(a.isActives.visualization))})},r.toggleMMLState=function(e){a.isActives.mml=!a.isActives.mml},r.togglePatchState=function(e){a.isActives.patch=!a.isActives.patch,a.isActives.patch&&$("#patch-container").colorbox({open:!0,inline:!0,href:"#patch-container",width:"600px",height:"480px",transition:"fade",speed:600,opacity:.6,fadeOut:600,returnFocus:!1,onOpen:function(){r.$broadcast("onOpenPatchDialog")},onCleanup:function(){t(function(){a.isActives.patch=!1})}})},r.changeWaveType=function(e,a,t){switch(a){case 0:angular.forEach(s,function(e){X("oscillator",e).param("type",t)});break;case 1:angular.forEach(s,function(e){C("oscillator",e).param("type",t)})}r.oscillators["oscillator"+a].type=t},r.triggerFileUploader=function(e){$(e.currentTarget).prev('[type="file"]').trigger("click")}}]),e.controller("AudioController",["$rootScope","$scope","$timeout","createTimeString",function(t,r,o,i){X("audio").setup({decode:function(e){o(function(){r.$parent.isModalProgressDecodeAudio=!0})},ready:function(e){var a=e.duration;o(function(){r.$parent.isModalProgressDecodeAudio=!1,r.isActive=!1,r.duration=a,r.durationText=i(a),r.currentTimeText="00 : 00.00"})},start:function(e,a){X("audio").module("recorder").start(),X("audio").module("session").start(),o(function(){r.isActive=!0})},stop:function(e,a){o(function(){r.isActive=!1})},update:function(e,a){Math.floor(a*e.buffer.sampleRate)%(.1*e.buffer.sampleRate)==0&&o(function(){t.currentTime=a,r.currentTimeText=i(a)})},ended:function(e,a){X("audio").module("analyser").domain("time-overview-L").update(0),X("audio").module("analyser").domain("time-overview-R").update(0),o(function(){r.isActive=!1,t.currentTime=0,r.currentTimeText="00 : 00.00"})}}),r.currentTime=0,r.currentTimeText="00 : 00.00",r.duration=0,r.durationText="00 : 00.00",r.isActive=!1,r.controlAudio=function(e){X("audio").toggle(X("audio").param("currentTime"))}}]),e.controller("RecordController",["$scope","$timeout","sources","openDialog","createDateTimeString",function(r,a,t,o,i){r.isActive=!1,r.tracks=[1,2,3,4],r.activeTrack=0,r.objectURL="",r.finename="",angular.forEach(t,function(e){"oscillator"!==e&&X(e).module("recorder").setup(r.tracks.length)}),r.controlRecord=function(e){e.preventDefault(),r.isActive?$("<div />").html("<p><b>Stop the recording. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{STOP:function(){angular.forEach(t,function(e){"oscillator"!==e&&X(e).module("recorder").stop()}),a(function(){r.isActive=!1}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}}):$("<div />").html("<p><b>Start recording in the TRACK "+(r.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{START:function(){angular.forEach(t,function(e){"oscillator"!==e&&(X(e).module("recorder").ready(r.activeTrack),"stream"===e&&X("stream").module("recorder").start())}),a(function(){r.isActive=!0}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},r.createWAVE=function(e){if(e.preventDefault(),!r.isActive){angular.forEach(t,function(e){if("oscillator"!==e){var a=X(e).module("recorder").create("all",16,2,"blob");if(a){r.objectURL=a;var t=new Audio(r.objectURL);t.setAttribute("controls",!1),t.play()}}})}},r.downloadWAVE=function(e){r.isActive?e.preventDefault():r.objectURL?r.filename="recorded-"+i()+".wav":(e.preventDefault(),o("Error",450,"auto",!0,"<p><b>The recorded sound data does not exists.</b></p>"))},r.clearTrack=function(e){e.preventDefault(),r.isActive||$("<div />").html("<p><b>Clear the TRACK "+(r.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{CLEAR:function(){angular.forEach(t,function(e){"oscillator"!==e&&X(e).module("recorder").clear(r.activeTrack)}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})}}]),e.controller("VisualizationController",["$rootScope","$scope","$document","$timeout","sources","drawNodeCallback",function(e,t,r,o,i,s){t.api="canvas",t.channel="left",t.setRealTimeAnalyser=function(e,a){X(e).module("analyser").param({fftSize:2048,minDecibels:-100,maxDecibels:-30,smoothingTimeConstant:.1}),X(e).module("analyser").domain("time").setup(r[0].getElementById(a+"-time")).param({interval:0,shape:"line",wave:"rgba(0, 0, 255, 1.0)",font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:2,right:15,type:"uint"}),X(e).module("analyser").domain("fft").setup(r[0].getElementById(a+"-spectrum")).param({interval:0,shape:"rect",wave:"gradient",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:2,right:15,type:"uint",size:256})},t.setAnalyser=function(e){X("audio").module("analyser").domain("time-overview-L").setup(r[0].getElementById(e+"-time-overview-L")).state(!0).param({shape:"rect",wave:"canvas"===e?"gradient":"rgba(0, 0, 255, 1)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:.5,right:15}),X("audio").module("analyser").domain("time-overview-R").setup(r[0].getElementById(e+"-time-overview-R")).state(!0).param({shape:"rect",wave:"canvas"===e?"gradient":"rgba(0, 0, 255, 1)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:.5,right:15})},t.selectAPI=function(a){t.api=a,angular.forEach(i,function(e){"oscillator"!==e&&t.setRealTimeAnalyser(e,a)}),t.setAnalyser(a),X("audio").module("analyser").domain("time-overview-L").drag(function(e){s(o,e)}),X("audio").module("analyser").domain("time-overview-R").drag(function(e){s(o,e)})},t.toggleAnalyserChannel=function(e,a){e.preventDefault(),t.channel=a},t.selectAPI("canvas")}]),e.controller("MMLController",["$rootScope","$scope","$http","$timeout","BASE_URL","oscillatorNumbers","createDateTimeString",function(e,r,a,o,t,i,s){var n={start:function(e,a){if("oscillator"===r.$parent.currentSoundSource&&X("mixer").mix([X("oscillator"),C("oscillator")]),"R"!==e.indexes[a]){var t=e.indexes[a];o(function(){r.$parent.isSoundStops[t]=!1})}},stop:function(e,a){if("R"!==e.indexes[a]){var t=e.indexes[a];o(function(){r.$parent.isSoundStops[t]=!0})}},ended:function(){angular.forEach(i,function(e){0!==e&&(X("oscillator",e).state(!1),C("oscillator",e).state(!1))}),r.readyMML(),r.paused=!0,r.$parent.clearKeyboards()},error:function(e,a){}};X("mml").setup(n),C("mml").setup(n),r.paused=!0,r.mml="",r.dataURL="",r.filename="",r.error="",r.$watch(function(){return r.$parent.currentSoundSource},function(){r.readyMML()}),a.get(Math.floor(2*Math.random())?t+"mml/mml-foreverlove.txt":t+"mml/mml-tears.txt").then(function(e){r.mml=e.data,r.typeMML()}).catch(function(e){}),r.typeMML=function(e){r.readyMML(),r.paused=!0},r.readyMML=function(){var e=r.mml.split(/\|+/);"oscillator"===r.$parent.currentSoundSource?1<e.length?(X("mml").ready(X("oscillator"),e[0]),C("mml").ready(C("oscillator"),e[1])):0<e.length&&(X("mml").ready(X("oscillator"),e[0]),C("mml").ready(C("oscillator"),[])):"piano"===r.$parent.currentSoundSource?X("mml").ready(X("oneshot"),e,0):"guitar"===r.$parent.currentSoundSource&&X("mml").ready(X("oneshot"),e,88)},r.controlMML=function(e){if(e.preventDefault(),X("mml").isSequences()){var a=X("mml").get();r.paused?("oscillator"===r.$parent.currentSoundSource?(angular.forEach(i,function(e){X("oscillator",e).state(!0),C("oscillator",e).state(!0)}),r.$parent.oscillators.oscillator0.isActive=!0,r.$parent.oscillators.oscillator1.isActive=!0,0<X("mml").get().length&&X("mml").start(0),0<C("mml").get().length&&C("mml").start(0),X("mixer").module("recorder").start(),X("mixer").module("session").start()):(angular.forEach(a,function(e,a){X("mml").start(a)}),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()),r.paused=!1):(X("mml").stop(),C("mml").stop(),angular.forEach(i,function(e){X("oscillator",e).state(!0),C("oscillator",e).state(!0)}),r.paused=!0)}},r.stopMML=function(e){X("mml").stop(),C("mml").stop(),r.readyMML(),r.paused=!0,r.$parent.clearKeyboards()},r.downloadMML=function(e){0!==r.mml.trim().length?(r.dataURL=X.toTextFile(r.mml),r.filename="mml-"+s()+".txt"):e.preventDefault()}}]),e.controller("SessionController",["$scope","$location","$timeout","sources","openDialog",function(t,e,a,r,o){var i=!1,s="",n="";n=-1!==e.host().indexOf("localhost")?(i=!1,s="localhost",""):(i=!0,s="x-sound-server.herokuapp.com/","/app/websocket/");var l=function(e){o("Confirmation",800,"auto",!1,"<p><b>Connection to ("+e.currentTarget.url+") succeeded.</b></p>"),a(function(){t.isActive=!0})},c=function(e){o("Confirmation",400,"auto",!0,"<p><b>Connection closed.</b></p>"),a(function(){t.isActive=!1})},u=function(e){o("Error",400,"auto",!0,"<p><b>Server Error.</b></p>"),a(function(){t.isActive=!1})},d=function(){a(function(){t.$parent.isModalProgressSessionWait=!1,X("mixer").module("session").state()?t.isActive=!0:t.isActive=!1})},p=function(e){t.$parent.isModalProgressSessionWait=!0};t.isActive=!1,t.url="",t.toggleSessionState=function(e){if(t.isActive=!t.isActive,t.isActive)if(X("mixer").module("session").isConnected()&&X("oneshot").module("session").isConnected()&&X("audio").module("session").isConnected()&&X("stream").module("session").isConnected())angular.forEach(r,function(e){"oscillator"!==e&&X(e).module("session").state(!0,d,p)});else{var a={tls:i,host:s,port:8e3,path:n,open:l,close:c,error:u};try{angular.forEach(r,function(e){"oscillator"!==e&&(X(e).module("session").setup(a).state(!0,d,p),a.port++)})}catch(e){t.isActive=!1,o("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}}else angular.forEach(r,function(e){"oscillator"!==e&&X(e).module("session").state(!1,d,p)})}}]),e.controller("PatchController",["$rootScope","$scope","$http","$window","$location","$timeout","sources","openDialog","getCurrentPatches",function(e,y,r,a,t,M,k,o,S){var i=1e4,s=-1!==t.host().indexOf("localhost")?"http://localhost/~rilakkuma3xjapan/portfolio-x-sound-server/php/bootstrap.php":"https://weblike-curtaincall.ssl-lolipop.jp/portfolio-x-sound-server/php/bootstrap.php",n=S(),l=function(e,a){if(angular.isObject(e)){var t=function(a,t){angular.forEach(k,function(e){X(e).module(a).state(t)}),C("oscillator").module(a).state(t),t?$('[effector="'+a+'"]').addClass("check-on"):$('[effector="'+a+'"]').removeClass("check-on")};if("mastervolume"in e&&$(".slider-mastervolume:not(:first)").slider("value",e.mastervolume),"glide"in e){var r=e.glide;"time"in r&&$(".slider-glide-time").slider("value",r.time)}if("envelopegenerator"in e){var o=e.envelopegenerator;"attack"in o&&$(".slider-envelopegenerator-attack").slider("value",o.attack),"decay"in o&&$(".slider-envelopegenerator-decay").slider("value",o.decay),"sustain"in o&&$(".slider-envelopegenerator-sustain").slider("value",o.sustain),"release"in o&&$(".slider-envelopegenerator-release").slider("value",o.release)}if("oscillator0"in e){var i=e.oscillator0;"state"in i&&M(function(){y.$parent.oscillators.oscillator0.isActive=!i,y.$parent.toggleOscillatorState(null,0)}),"type"in i&&M(function(){y.$parent.changeWaveType(null,0,i.type)}),"gain"in i&&$(".slider-volume:first").slider("value",i.gain),"octave"in i&&$(".slider-octave:first").slider("value",i.octave),"fine"in i&&$(".slider-fine:first").slider("value",i.fine)}if("oscillator1"in e){var s=e.oscillator1;"state"in s&&M(function(){y.$parent.oscillators.oscillator1.isActive=!s,y.$parent.toggleOscillatorState(null,1)}),"type"in s&&M(function(){y.$parent.changeWaveType(null,1,s.type)}),"gain"in s&&$(".slider-volume:last").slider("value",s.gain),"octave"in s&&$(".slider-octave:last").slider("value",s.octave),"fine"in s&&$(".slider-fine:last").slider("value",s.fine)}if("compressor"in e){var n=e.compressor;"state"in n&&t("compressor",n.state),"threshold"in n&&$(".slider-threshold").slider("value",n.threshold),"knee"in n&&$(".slider-knee").slider("value",n.knee),"ratio"in n&&$(".slider-ratio").slider("value",n.ratio),"attack"in n&&$(".slider-compressor-attack").slider("value",n.attack),"release"in n&&$(".slider-compressor-release").slider("value",n.release)}if("distortion"in e){var l=e.distortion;"state"in l&&t("distortion",l.state),"curve"in l&&$("#select-distortion-type").val(l.curve).trigger("change"),"samples"in l&&$("#select-distortion-sample").val("value",l.samples),"drive"in l&&$(".slider-distortion-drive").slider("value",l.drive),"color"in l&&$(".slider-distortion-color").slider("value",l.color),"tone"in l&&$(".slider-distortion-tone").slider("value",l.tone)}if("wah"in e){var c=e.wah;"state"in c&&t("wah",c.state),"cutoff"in c&&$(".slider-wah-cutoff").slider("value",c.cutoff),"depth"in c&&$(".slider-wah-depth").slider("value",c.depth),"rate"in c&&$(".slider-wah-rate").slider("value",c.rate),"resonance"in c&&$(".slider-wah-resonance").slider("value",c.resonance)}if("equalizer"in e){var u=e.equalizer;"state"in u&&t("equalizer",u.state),"bass"in u&&$(".slider-equalizer-bass").slider("value",u.bass),"middle"in u&&$(".slider-equalizer-middle").slider("value",u.middle),"treble"in u&&$(".slider-equalizer-treble").slider("value",u.treble),"presence"in u&&$(".slider-equalizer-presence").slider("value",u.presence)}if("filter"in e){var d=e.filter;"state"in d&&t("filter",d.state),"type"in d&&$("#select-filter-type").val(d.type).trigger("change"),"frequency"in d&&$(".slider-filter-cutoff").slider("value",d.frequency),"Q"in d&&$(".slider-filter-Q").slider("value",d.Q),"gain"in d&&$(".slider-filter-gain").slider("value",d.gain),"attack"in d&&$(".slider-filter-attack").slider("value",d.attack),"decay"in d&&$(".slider-filter-decay").slider("value",d.decay),"sustain"in d&&$(".slider-filter-sustain").slider("value",d.sustain),"release"in d&&$(".slider-filter-release").slider("value",d.release)}if("autopanner"in e){var p=e.autopanner;"state"in p&&t("autopanner",p.state),"depth"in p&&$(".slider-autopanner-depth").slider("value",p.depth),"rate"in p&&$(".slider-autopanner-rate").slider("value",p.rate)}if("tremolo"in e){var m=e.tremolo;"state"in m&&t("tremolo",m.state),"depth"in m&&$(".slider-tremolo-depth").slider("value",m.depth),"rate"in m&&$(".slider-tremolo-rate").slider("value",m.rate)}if("ringmodulator"in e){var h=e.ringmodulator;"state"in h&&t("ringmodulator",h.state),"depth"in h&&$(".slider-ringmodulator-depth").slider("value",h.depth),"rate"in h&&$(".slider-ringmodulator-rate").slider("value",h.rate)}if("phaser"in e){var f=e.phaser;"state"in f&&t("phaser",f.state),"stage"in f&&$(".select-phaser-stage").val(f.stage),"frequency"in f&&$(".slider-phaser-cutoff").slider("value",f.frequency),"depth"in f&&$(".slider-phaser-depth").slider("value",f.depth),"rate"in f&&$(".slider-phaser-rate").slider("value",f.rate),"mix"in f&&$(".slider-phaser-mix").slider("value",f.mix),"feedback"in f&&$(".slider-phaser-feedback").slider("value",f.feedback)}if("flanger"in e){var v=e.flanger;"state"in v&&t("flanger",v.state),"time"in v&&$(".slider-flanger-time").slider("value",v.time),"depth"in v&&$(".slider-flanger-depth").slider("value",v.depth),"rate"in v&&$(".slider-flanger-rate").slider("value",v.rate),"mix"in v&&$(".slider-flanger-mix").slider("value",v.mix),"tone"in v&&$(".slider-flanger-tone").slider("value",v.tone),"feedback"in v&&$(".slider-flanger-feedback").slider("value",v.feedback)}if("chorus"in e){var g=e.chorus;"state"in g&&t("chorus",g.state),"time"in g&&$(".slider-chorus-time").slider("value",g.time),"depth"in g&&$(".slider-chorus-depth").slider("value",g.depth),"rate"in g&&$(".slider-chorus-rate").slider("value",g.rate),"mix"in g&&$(".slider-chorus-mix").slider("value",g.mix),"tone"in g&&$(".slider-chorus-tone").slider("value",g.tone),"feedback"in g&&$(".slider-chorus-feedback").slider("value",g.feedback)}if("delay"in e){var b=e.delay;"state"in b&&t("delay",b.state),"time"in b&&$(".slider-delay-time").slider("value",b.time),"dry"in b&&$(".slider-delay-dry").slider("value",b.dry),"wet"in b&&$(".slider-delay-wet").slider("value",b.wet),"tone"in b&&$(".slider-delay-tone").slider("value",b.tone),"feedback"in b&&$(".slider-delay-feedback").slider("value",b.feedback)}if("reverb"in e){var w=e.reverb;"state"in w&&t("reverb",w.state),"dry"in w&&$(".slider-reverb-dry").slider("value",w.dry),"wet"in w&&$(".slider-reverb-wet").slider("value",w.wet),"tone"in w&&$(".slider-reverb-tone").slider("value",w.tone)}M(function(){y.currentPatches=S(),a&&history.pushState(S(),null)})}},c=function(){o("Error",500,"auto",!1,"<p><b>Connection to Server failed.</b></p>")};a.onpopstate=function(e){e.state?l(e.state,!1):l(n,!1)},y.isAuth=!1,y.isSignin=!0,y.isSignup=!1,y.isPatchList=!1,y.isSavePath=!1,y.isAccount=!1,y.isDisabled=!1,y.csrf="",y.signups={username:"",password:""},y.signins={username:"",password:""},y.deleteAccounts={username:"",password:""},y.authedUsername="",y.patchname="",y.patchLists=[],y.dialogPatchDetailId="dialog-patch-detail",y.isShowDialogPatchDetail=!1,y.$watch(function(){return y.isAuth},function(e){e?(y.signups={username:"",password:""},y.signins={username:"",password:""},y.currentPatches=S(),y.toggleAction(null,"patchList")):(y.deleteAccounts={username:"",password:""},y.currentPatches={},y.patches={},y.patchname="",y.patchLists=[],y.authedUsername="",y.isShowDialogPatchDetail=!1,y.toggleAction(null,"signin"))}),y.$on("onOpenPatchDialog",function(e){y.currentPatches=S()}),y.cancelClose=function(e){e.stopImmediatePropagation()},y.toggleAction=function(e,a){switch(null!==e&&e.preventDefault(),y.isSignin=!1,y.isSignup=!1,y.isPatchList=!1,y.isSavePatch=!1,y.isAccount=!1,a){case"signin":y.isSignin=!0;break;case"signup":y.isSignup=!0;break;case"patchList":y.isPatchList=!0;break;case"savePatch":y.isSavePatch=!0;break;case"account":y.isAccount=!0}},y.signin=function(e){e.preventDefault(),y.isDisabled=!0,r({method:"POST",url:s+"/account/signin",timeout:i,withCredentials:!0,params:"",data:{username:y.signins.username,password:y.signins.password,_csrf:y.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(y.csrf=a.csrf,y.isAuth=a.isAuth,y.authedUsername=a.username,y.patchLists=angular.fromJson(a.patches)),y.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(y.csrf=a.csrf,angular.forEach(a.message,function(e){o("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),y.isDisabled=!1})},y.signup=function(e){e.preventDefault(),y.isDisabled=!0,r({method:"POST",url:s+"/account/signup",timeout:i,withCredentials:!0,params:"",data:{username:y.signups.username,password:y.signups.password,_csrf:y.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(y.csrf=a.csrf,y.isAuth=a.isAuth,y.authedUsername=a.username,angular.forEach(a.message,function(e){o("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")})),y.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(y.csrf=a.csrf,angular.forEach(a.message,function(e){o("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),y.isDisabled=!1})},y.signout=function(e){y.isDisabled=!0,r({method:"POST",url:s+"/account/signout",timeout:i,withCredentials:!0,params:"",data:{_csrf:y.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(y.csrf=a.csrf,angular.forEach(a.message,function(e){o("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")})),y.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(y.csrf=a.csrf,angular.forEach(a.message,function(e){o("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),y.isDisabled=!1})},y.deleteAccount=function(e){$("<div />").html('<p><b>Delete your account. OK ?<br /> <b class="dangerous">If you delete account, the all of patches that you saved are also deleted.</b></b></p>').dialog({title:"Confirmation",autoOpen:!0,show:"bounce",hide:"explode",modal:!1,width:650,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){y.isDisabled=!0,r({method:"POST",url:s+"/account/delete",timeout:i,withCredentials:!0,params:"",data:{username:y.deleteAccounts.username,password:y.deleteAccounts.password,_csrf:y.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(y.csrf=a.csrf,y.isAuth=a.isAuth,y.authedUsername=a.username,y.isAuth||angular.forEach(a.message,function(e){o("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")})),y.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(y.csrf=a.csrf,angular.forEach(a.message,function(e){o("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),y.isDisabled=!1}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},y.typePatchname=function(e){y.patchname=e.currentTarget.value},y.savePatch=function(e){y.isDisabled=!0,r({method:"POST",url:s+"/patch/add",timeout:i,withCredentials:!0,params:"",data:{name:y.patchname,patch:angular.toJson(S()),_csrf:y.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(y.csrf=a.csrf,y.isAuth=a.isAuth,y.patchLists=angular.fromJson(a.patches),angular.forEach(a.message,function(e){o("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")})),y.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(y.csrf=a.csrf,y.isAuth=a.isAuth,angular.forEach(a.message,function(e){o("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),y.isDisabled=!1})},y.openPatchDetail=function(e,a){if(angular.isObject(a)&&angular.isObject(a.patch))y.patches=a.patch;else{if(!angular.isString(a.patch))return;var t=a.patch.replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&");y.patches=angular.fromJson(t)}y.isShowDialogPatchDetail=!0,$("#"+y.dialogPatchDetailId).dialog({title:a.name,autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:600,height:400,draggable:!0,resizable:!1,zIndex:9999,position:{my:"center top",at:"center top"},buttons:{LOAD:function(){l(y.patches,!0),$(this).dialog("close")},UPDATE:function(){$("<div />").html("<p><b>Update the patch. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:1e4,buttons:{OK:function(){var e;e=a.name,r({method:"POST",url:s+"/patch/update",timeout:i,withCredentials:!0,params:"",data:{name:e,patch:angular.toJson(S()),_csrf:y.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(y.csrf=a.csrf,y.isAuth=a.isAuth,y.patchLists=angular.fromJson(a.patches),angular.forEach(a.message,function(e){o("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")}))}).catch(function(e){var a=e.data;angular.isObject(a)?(y.csrf=a.csrf,y.isAuth=a.isAuth,angular.forEach(a.message,function(e){o("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c()}),$(this).dialog("close").dialog("destroy").remove(),$("#"+y.dialogPatchDetailId).dialog("close")},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},DELETE:function(){$("<div />").html("<p><b>Delete the patch. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:1e4,buttons:{OK:function(){var e;e=a.name,r({method:"POST",url:s+"/patch/delete",timeout:i,withCredentials:!0,params:"",data:{name:e,_csrf:y.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(y.csrf=a.csrf,y.isAuth=a.isAuth,y.patchLists=angular.fromJson(a.patches),angular.forEach(a.message,function(e){o("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")}))}).catch(function(e){var a=e.data;angular.isObject(a)?(y.csrf=a.csrf,y.isAuth=a.isAuth,angular.forEach(a.message,function(e){o("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c()}),$(this).dialog("close").dialog("destroy").remove(),$("#"+y.dialogPatchDetailId).dialog("close")},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},CLOSE:function(){$(this).dialog("close")}},close:function(e,a){$(this).dialog("destroy"),M(function(){y.isShowDialogPatchDetail=!1})}})},r({method:"GET",url:s,timeout:i,withCredentials:!0,params:"",headers:{}}).then(function(e){var a=e.data;angular.isObject(a)&&(y.isAuth=a.isAuth,y.authedUsername=a.username,y.csrf=a.csrf,y.isAuth&&(y.patchLists=angular.fromJson(a.patches)))}).catch(function(e){c()})}])}();
//# sourceMappingURL=controller.min.js.map
