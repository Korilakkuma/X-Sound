/**
 * controller.min.js
 * @fileoverview AngularJS controller for X Sound Application
 *
 * JavaScript Libraries :
 *     XSound.js (https://github.com/Korilakkuma/XSound)
 *     jQuery / jQuery UI
 *     select2.js
 *
 * Copyright (c) 2012, 2013, 2014 Tomohiro IKEDA (Korilakkuma)
 * Released under the MIT license
 */
!function(){"use strict";var e=angular.module("xsound",[]);e.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|data|blob):/)}]),e.factory("BASE_URL",["$location",function(e){var a="";return a="localhost"===e.host()?e.protocol()+"://"+e.host()+"/~rilakkuma3xjapan/GitHub/X-Sound/resources/":e.protocol()+"://"+e.host()+"/X-Sound/resources/"}]),e.value("sources",["mixer","oscillator","oneshot","audio","stream"]),e.value("updateParamEachOscillator",function(e,a,t,r){var o=[0,1,2,3];switch(e){case 0:a?angular.forEach(o,function(e){X("oscillator",e).module(a).param(t,r)}):angular.forEach(o,function(e){X("oscillator",e).param(t,r)});break;case 1:a?angular.forEach(o,function(e){C("oscillator",e).module(a).param(t,r)}):angular.forEach(o,function(e){C("oscillator",e).param(t,r)})}}),e.value("updateParamOfModule",function(e,a,t,r){"oscillator"===e&&"envelopegenerator"===a?(X("oscillator").module("envelopegenerator").param(t,r),C("oscillator").module("envelopegenerator").param(t,r)):"analyser"===a&&"interval"===t?r>0?(X(e).module("analyser").domain("time").param("interval",r),X(e).module("analyser").domain("fft").param("interval",r)):(X(e).module("analyser").domain("time").param("interval","auto"),X(e).module("analyser").domain("fft").param("interval","auto")):(X(e).module(a).param(t,r),"oscillator"===e&&C("oscillator").module(a).param(t,r))}),e.value("updateParamOfSource",function(e,a,t){"oneshot"===e&&"playbackRate"===a?X("oneshot").param("transpose",t):(X(e).param(a,t),C("oscillator").param(a,t))}),e.factory("updateParam",["updateParamEachOscillator","updateParamOfModule","updateParamOfSource",function(e,a,t){return function(r,o,i,s){var n=[];n=r?r.split(" "):["mixer","oscillator","oneshot","audio","stream"],angular.forEach(n,function(r){var n=r.match(/oscillator(0|1)/);null!==n?e(parseInt(n[1]),o,i,s):o?a(r,o,i,s):t(r,i,s)})}}]),e.value("openDialog",function(e,a,t,r,o){$("<div />").html(o).dialog({title:e,autoOpen:!0,show:"explode",hide:"explode",width:a,height:t,modal:r,draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){$(this).dialog("close").dialog("destroy").remove()}}})}),e.factory("readFile",["openDialog",function(e){return function(a){var t=null;try{t=X.file(a)}catch(r){e("Error",500,"auto",!0,"<p><b>"+r.message+"</b></p>")}return t}}]),e.factory("readFileByDragAndDrop",["readFile",function(e){return function(a,t){a.addEventListener("dragenter",function(e){e.preventDefault(),$(this).removeClass("drag-off").addClass("drag-on")}),a.addEventListener("dragover",function(e){e.preventDefault()}),a.addEventListener("dragleave",function(e){$(this).removeClass("drag-on").addClass("drag-off")}),a.addEventListener("drop",function(a){$(this).removeClass("drag-on").addClass("drag-off"),t.event=a;var r=e(t);r instanceof Blob&&(this.value=r.name)})}}]),e.factory("readFileErrorCallback",["openDialog",function(e){return function(a){var t="";switch(a){case"FILE_IS_NOT_BLOB":t="The designated file is not Blob";break;case"NOT_FOUND_ERR":t="There is not file";break;case"SECURITY_ERR":t="Security error occurred";break;case"ABORT_ERR":t="Abort";break;case"NOT_READABLE_ERR":t="The authority to read file does not exists";break;case"ENCODING_ERR":t="FIle size exceeds limit";break;case"ERR":t="Error. Please try again."}e("Error",500,"auto",!0,"<p><b>"+t+"</b></p>")}}]),e.value("readFileProgressCallback",function(e,a,t){var r=0,o="";t.lengthComputable&&t.total>0&&(r=Math.floor(t.loaded/t.total*100),o=t.loaded+" Bytes load ("+r+" %)",a(function(){e.readFileProgress=o,e.isModalProgressReadFile||(e.isModalProgressReadFile=!0)}))}),e.factory("drawNodeCallback",["$rootScope",function(e){return function(a,t){t>=0&&t<=X("audio").param("duration")&&(X("audio").param("currentTime",t),X("audio").module("analyser").domain("time-overview-L").update(t),X("audio").module("analyser").domain("time-overview-R").update(t),a(function(){e.currentTime=t}))}}]),e.value("createTimeString",function(e){var a=X.convertTime(e);return 0===a.milliseconds?("0"+a.minutes).slice(-2)+" : "+("0"+a.seconds).slice(-2)+".00":("0"+a.minutes).slice(-2)+" : "+("0"+a.seconds).slice(-2)+"."+String(a.milliseconds).slice(2,4)}),e.value("createDateTimeString",function(){var e=function(e){return("0"+e).slice(-2)},a=new Date,t=a.getFullYear(),r=e(a.getMonth()+1),o=e(a.getDate()),i=e(a.getHours()),s=e(a.getMinutes()),n=e(a.getSeconds()),l=t+r+o+i+s+n;return l}),e.value("getCurrentPatches",function(){return{mastervolume:X("oscillator").params().mastervolume,glide:{type:X("oscillator").params().oscillator.glide.type,time:X("oscillator").params().oscillator.glide.time},oscillator0:X("oscillator").params().oscillator.oscillator0,oscillator1:C("oscillator").params().oscillator.oscillator0,envelopegenerator:{attack:X("oscillator").params().envelopegenerator.attack,decay:X("oscillator").params().envelopegenerator.decay,sustain:X("oscillator").params().envelopegenerator.sustain,release:X("oscillator").params().envelopegenerator.release},compressor:{state:X("oscillator").params().compressor.state,threshold:X("oscillator").params().compressor.threshold,knee:X("oscillator").params().compressor.knee,ratio:X("oscillator").params().compressor.ratio,attack:X("oscillator").params().compressor.attack,release:X("oscillator").params().compressor.release},distortion:{state:X("oscillator").params().distortion.state,curve:X("oscillator").params().distortion.curve,samples:X("oscillator").params().distortion.samples,drive:X("oscillator").params().distortion.drive,color:X("oscillator").params().distortion.color,tone:X("oscillator").params().distortion.tone},wah:{state:X("oscillator").params().wah.state,cutoff:X("oscillator").params().wah.cutoff,depth:X("oscillator").params().wah.depth,rate:X("oscillator").params().wah.rate,resonance:X("oscillator").params().wah.resonance},equalizer:{state:X("oscillator").params().equalizer.state,bass:X("oscillator").params().equalizer.bass,middle:X("oscillator").params().equalizer.middle,treble:X("oscillator").params().equalizer.treble,presence:X("oscillator").params().equalizer.presence},filter:{state:X("oscillator").params().filter.state,type:X("oscillator").params().filter.type,frequency:X("oscillator").params().filter.frequency,Q:X("oscillator").params().filter.Q,gain:X("oscillator").params().filter.gain,attack:X("oscillator").params().filter.attack,decay:X("oscillator").params().filter.decay,sustain:X("oscillator").params().filter.sustain,release:X("oscillator").params().filter.release},autopanner:{state:X("oscillator").params().autopanner.state,depth:X("oscillator").params().autopanner.depth,rate:X("oscillator").params().autopanner.rate},tremolo:{state:X("oscillator").params().tremolo.state,depth:X("oscillator").params().tremolo.depth,rate:X("oscillator").params().tremolo.rate},ringmodulator:{state:X("oscillator").params().ringmodulator.state,depth:X("oscillator").params().ringmodulator.depth,rate:X("oscillator").params().ringmodulator.rate},phaser:{state:X("oscillator").params().phaser.state,stage:X("oscillator").params().phaser.stage,frequency:X("oscillator").params().phaser.frequency,depth:X("oscillator").params().phaser.depth,rate:X("oscillator").params().phaser.rate,mix:X("oscillator").params().phaser.mix,feedback:X("oscillator").params().phaser.feedback},chorus:{state:X("oscillator").params().chorus.state,time:1e3*X("oscillator").params().chorus.time,depth:X("oscillator").params().chorus.depth,rate:X("oscillator").params().chorus.rate,mix:X("oscillator").params().chorus.mix,tone:X("oscillator").params().chorus.tone},flanger:{state:X("oscillator").params().flanger.state,time:1e3*X("oscillator").params().flanger.time,depth:X("oscillator").params().flanger.depth,rate:X("oscillator").params().flanger.rate,mix:X("oscillator").params().flanger.mix,tone:X("oscillator").params().flanger.tone,feedback:X("oscillator").params().flanger.feedback},delay:{state:X("oscillator").params().delay.state,time:1e3*X("oscillator").params().delay.time,dry:X("oscillator").params().delay.dry,wet:X("oscillator").params().delay.wet,tone:X("oscillator").params().delay.tone,feedback:X("oscillator").params().delay.feedback},reverb:{state:X("oscillator").params().reverb.state,dry:X("oscillator").params().reverb.dry,wet:X("oscillator").params().reverb.wet,tone:X("oscillator").params().reverb.tone}}}),e.run(["$rootScope","$window","sources","openDialog",function(e,a,t,r){return X.IS_XSOUND?(e.isActives={visualization:!1,mml:!1,patch:!1},e.currentTime=0,a.C=X.clone(),X.free([X("media"),X("fallback"),C("oneshot"),C("audio"),C("media"),C("fallback"),C("stream"),C("mixer"),C("midi")]),X("mixer").resize(4096),X("oscillator").resize(4096),C("oscillator").resize(4096),X("oneshot").resize(4096),X("audio").resize(8192),X("stream").resize(512),X("oscillator").setup([!0,!1,!1,!1]),C("oscillator").setup([!1,!1,!1,!1]),X("stream").setup(!1,function(e){console.dir(e)},function(e){r("Confirmation",400,"auto",!0,"<p><b>Cancel Microphone.</b></p>"),console.dir(e)}),angular.forEach(t,function(e){X(e).module("distortion").param("color",2e3),X(e).module("distortion").param("tone",4e3),X(e).module("chorus").param("tone",4e3),X(e).module("flanger").param("tone",4e3),X(e).module("delay").param("tone",4e3),X(e).module("reverb").param("tone",4e3),X(e).module("filter").param("frequency",8e3)}),C("oscillator").module("distortion").param("color",2e3),C("oscillator").module("distortion").param("tone",4e3),C("oscillator").module("chorus").param("tone",4e3),C("oscillator").module("flanger").param("tone",4e3),C("oscillator").module("delay").param("tone",4e3),C("oscillator").module("reverb").param("tone",4e3),void C("oscillator").module("filter").param("frequency",8e3)):void r("Error",600,"auto",!0,"<p><b>Your Browser does not support Web Audio API. Please use Chrome, Opera, Firefox (Mac / Windows) or Safari (Mac).</b></p>")}]),e.directive("uiSlider",["updateParam",function(e){return{restrict:"E",template:"<div></div>",link:function(a,t,r,o,i){var s=r.value,n=r.min,l=r.max,c=r.step,u=r.range||"min",d=r.animate||"slow",p=r.source,m=r.module,f=r.param,h=m?m+"-"+f:f,v=function(a){e(p,m,f,a),$(".spinner-"+h).each(function(e,t){var r=$(t).parents("ui-spinner");r.attr("source")===p&&r.attr("module")===m&&("glide"!==m&&"time"===f&&(a*=Math.pow(10,3)),$(t).spinner("value",a))})};$(t).children("div").addClass("slider-"+h).slider({value:parseFloat(s),min:parseFloat(n),max:parseFloat(l),step:parseFloat(c),range:u,animate:d,change:function(e,a){var t=parseFloat(a.value);"glide"!==m&&"time"===f&&(t/=Math.pow(10,3)),v(t)},slide:function(e,a){var t=parseFloat(a.value);"glide"!==m&&"time"===f&&(t/=Math.pow(10,3)),v(t)}})}}}]),e.directive("uiSpinner",["updateParam",function(e){return{restrict:"E",template:"<input />",link:function(a,t,r,o,i){var s=r.value,n=r.min,l=r.max,c=r.step,u=r.source,d=r.module,p=r.param,m=d?d+"-"+p:p,f=function(a){e(u,d,p,a),$(".slider-"+m).each(function(e,t){var r=$(t).parent("ui-slider");r.attr("source")===u&&r.attr("module")===d&&("glide"!==d&&"time"===p&&(a*=Math.pow(10,3)),$(t).slider("value",a))})};$(t).children("input").addClass("spinner-"+m).spinner({min:parseFloat(n),max:parseFloat(l),step:parseFloat(c),spin:function(e,a){var t=parseFloat(a.value);"glide"!==d&&"time"===p&&(t/=Math.pow(10,3)),f(t)}}).spinner("value",parseFloat(s))}}}]),e.directive("uiSliderTime",["$rootScope","$timeout","createTimeString",function(e,a,t){return{restrict:"E",template:"<div></div>",link:function(r,o,i,s,n){var l=i.value,c=i.max,u=i.step,d=i.range||"min",p=i.animate||"slow";$(o).children("div").attr("id","slider-audio-current-time").slider({value:parseFloat(l),min:0,max:parseFloat(c),step:parseFloat(u),range:d,animate:p,change:function(e,a){},slide:function(t,r){X("audio").param("currentTime",parseFloat(r.value)),X("audio").module("analyser").domain("time-overview-L").update(X("audio").param("currentTime")),X("audio").module("analyser").domain("time-overview-R").update(X("audio").param("currentTime")),a(function(){e.currentTime=X("audio").param("currentTime")})}}),r.$watch(function(){return r.duration},function(e){$("#slider-audio-current-time").slider("option","max",e),$("#spinner-audio-current-time").spinner("option","max",e)});var m=function(e){$("#slider-audio-current-time").slider("value",e),$("#spinner-audio-current-time").spinner("value",e),r.currentTimeText=t(e)};r.$watch(function(){return e.currentTime},function(e){m(e)})}}}]),e.directive("uiSpinnerTime",["$rootScope","$timeout",function(e,a){return{restrict:"E",template:"<input />",link:function(t,r,o,i,s){var n=o.value,l=o.max,c=o.step;$(r).children("input").attr("id","spinner-audio-current-time").spinner({min:0,max:parseFloat(l),step:parseFloat(c),spin:function(t,r){X("audio").param("currentTime",parseFloat(r.value)),X("audio").module("analyser").domain("time-overview-L").update(X("audio").param("currentTime")),X("audio").module("analyser").domain("time-overview-R").update(X("audio").param("currentTime")),a(function(){e.currentTime=X("audio").param("currentTime")})}}).spinner("value",parseFloat(n))}}}]),e.directive("uiToggleEffector",["sources",function(e){return{restrict:"A",link:function(a,t,r,o,i){var s=r.effector,n=parseInt(r.state);(0===n||1===n)&&angular.forEach(e,function(e){X(e).module(s).state(Boolean(n)),C("oscillator").module(s).state(Boolean(n)),X(e).module(s).state()?$(t).addClass("check-on"):$(t).removeClass("check-on")}),$(t).on("click",function(){angular.forEach(e,function(e){X(e).module(s).state()?(X(e).module(s).state(!1),C("oscillator").module(s).state(!1),$(t).removeClass("check-on")):(X(e).module(s).state(!0),C("oscillator").module(s).state(!0),$(t).addClass("check-on"))})})}}}]),e.directive("uiModalProgress",[function(){return{restrict:"E",link:function(e,a,t,r,o){$(a).css({position:"fixed",top:"0px",left:"0px","z-index":999,padding:"15% 0%",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.6)"})}}}]),e.directive("uiTooltip",function(){return{restrict:"A",link:function(e,a,t,r,o){$(a).tooltip({tooltipClass:"ui-tooltip-custom"})}}}),e.directive("uiSortable",function(){return{restrict:"A",link:function(e,a,t,r,o){$(a).sortable({axis:"x",cancel:"fieldset, :input, button, label, a, #piano",cursor:"move",opacity:.6})}}}),e.directive("uiSelect",["$timeout","sources","openDialog",function(e,a,t){return{restrict:"A",link:function(r,o,i,s,n){switch($(o).select2(),$(o).attr("id")){case"select-sound-source":$(o).on("change",function(){var a=this.value;switch(a){case"oscillator":X("stream").stop(),e(function(){r.currentSoundSource=a,r.selectedSoundSource=a});break;case"one-shot":r.isEnableOneshot&&e(function(){r.currentSoundSource=a,r.selectedSoundSource=a}),X("stream").stop();break;case"stream":try{X("stream").start(),X("stream").module("session").start(),e(function(){r.selectedSoundSource=a})}catch(o){t("Error",400,"auto",!0,"<p><b>"+o.message+"</b></p>")}break;case"midi":X("stream").stop();var i=function(a,t,o){var i=21,s=108,n=127,l=[],c=[],u=function(a,t){if(!(i>a||a>s||0>t||t>n)){var o=a-i,u=t/n;if("oscillator"===r.currentSoundSource){l.push(o),c[0]=X("oscillator",0).param("volume"),c[1]=C("oscillator",0).param("volume");for(var d=0,p=X("oscillator").length();p>d;d++)0!==d&&(X("oscillator",d).state(!0),C("oscillator",d).state(!0)),X("oscillator",d).param("volume",u),C("oscillator",d).param("volume",u);X("oscillator").ready(0,0).start(X.toFrequencies(l)),C("oscillator").ready(0,0).start(X.toFrequencies(l)),X("mixer").mix([X("oscillator"),C("oscillator")]),X("mixer").module("recorder").start(),X("mixer").module("session").start()}else X("oneshot").reset(o,"volume",u).ready(0,0).start(o),X("oneshot").module("recorder").start(),X("oneshot").module("session").start();e(function(){r.isSoundStops[o]=!1})}},d=function(a,t){if(!(i>a||a>s||0>t||t>n)){var o=a-i;if("oscillator"===r.currentSoundSource){var u=l.indexOf(o);-1!==u&&l.splice(u,1),X("oscillator").stop(),C("oscillator").stop();for(var d=0,p=X("oscillator").length();p>d;d++)0!==d&&(X("oscillator",d).state(!1),C("oscillator",d).state(!1)),X("oscillator",d).param("volume",c[0]),C("oscillator",d).param("volume",c[1])}else X("oneshot").stop(o).reset(o,"volume",1);e(function(){r.isSoundStops[o]=!0})}};t.length>0&&(t[0].onmidimessage=function(e){switch(240&e.data[0]){case 144:u(e.data[1],e.data[2]);break;case 128:d(e.data[1],e.data[2])}})},s=function(e){t("Error",400,"auto",!0,"<p><b>Cannot use Web MIDI API.</b></p>")};try{X("midi").setup(!0,i,s)}catch(o){t("Error",400,"auto",!0,"<p><b>"+o.message+"</b></p>")}}});break;case"select-rec-track":$(o).on("change",function(){if(!r.isActive){var t=parseInt(this.value);e(function(){r.activeTrack=t}),angular.forEach(a,function(e){"oscillator"!==e&&"audio"!==e&&(X(e).module("recorder").ready(t),"stream"===e&&X("stream").module("recorder").start())})}});break;case"select-visualization-api":$(o).on("change",function(){r.selectAPI(this.value)});break;case"select-distortion-type":$(o).on("change",function(){var e=this.value;angular.forEach(a,function(a){X(a).module("distortion").param("curve",e)})});break;case"select-distortion-sample":$(o).on("change",function(){var e=this.value;angular.forEach(a,function(a){X(a).module("distortion").param("samples",e)})});break;case"select-filter-type":$(o).on("change",function(){var e=this.value;angular.forEach(a,function(a){X(a).module("filter").param("type",e)})});break;case"select-phaser-stage":$(o).on("change",function(){var e=this.value;angular.forEach(a,function(a){X(a).module("phaser").param("stage",e)})});case"select-reverb-type":$(o).on("change",function(){var e=parseInt(this.value)-1;-1===e&&(e=null),angular.forEach(a,function(a){X(a).module("reverb").param("type",e)})})}}}}]),e.directive("slideBlock",["$rootScope",function(e){return{restrict:"A",link:function(a,t,r,o,i){var s=1e3,n="easeOutQuint",l=r.model;$(t).hide(),a.$watch(function(){return e.isActives},function(e){e[l]?$(t).slideDown(s,n):$(t).slideUp(s,n)},!0)}}}]),e.directive("audioUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(e,a,t,r,o){return{restrict:"A",link:function(i,s,n,l,c){var u=s[0],d={event:null,type:"ArrayBuffer",success:function(a,t){X("audio").ready.call(X("audio"),t),e(function(){i.isModalProgressReadFile=!1})},error:function(e,a){o(a)},progress:function(a){r(i,e,a)}};u.addEventListener("change",function(e){d.event=e;var t=a(d);this.value="",t instanceof Blob&&$(s).next('[type="text"]').val(t.name)},!1);var p=$(s).next('[type="text"]')[0];t(p,d)}}}]),e.directive("rirUploader",["$timeout","sources","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(e,a,t,r,o,i){return{restrict:"A",link:function(s,n,l,c,u){var d=n[0],p={event:null,type:"ArrayBuffer",success:function(t,r){angular.forEach(a,function(e){X(e).module("reverb").start.call(X(e).module("reverb"),r)}),e(function(){s.isModalProgressReadFile=!1})},error:function(e,a){i(a)},progress:function(a){o(s,e,a)}};d.addEventListener("change",function(e){p.event=e;var a=t(p);this.value="",a instanceof Blob&&$(n).next('[type="text"]').val(a.name)},!1);var m=$(n).next('[type="text"]')[0];r(m,p)}}}]),e.directive("mmlUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(e,a,t,r,o){return{restrict:"A",link:function(i,s,n,l,c){var u=s[0],d={event:null,type:"Text",success:function(a,t){var r=function(){e(function(){i.mml=t,i.paused=!0,i.readyMML()})};""===i.mml?r():$("<div />").html("<p><b>MML already exists. Overwrite ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:500,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){r(),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}}),e(function(){i.isModalProgressReadFile=!1})},error:function(e,a){o(a)},progress:function(a){r(i,e,a)}};u.addEventListener("change",function(e){d.event=e;var t=a(d);this.value="",t instanceof Blob&&$(s).next('[type="text"]').val(t.name)},!1);var p=$(s).next('[type="text"]')[0];t(p,d)}}}]),e.controller("XSoundController",["$rootScope","$scope","$window","$timeout","BASE_URL","sources","openDialog","getCurrentPatches",function(e,a,t,r,o,i,s,n){var l=88,c=6e4,u=[o+"one-shot/piano-2/C.wav",o+"one-shot/piano-2/D.wav",o+"one-shot/piano-2/E.wav",o+"one-shot/piano-2/F.wav",o+"one-shot/piano-2/G.wav",o+"one-shot/piano-2/A.wav",o+"one-shot/piano-2/B.wav"],d=function(e){switch(parseInt((e+9)%12)){case 0:case 1:return 0;case 2:case 3:return 1;case 4:return 2;case 5:case 6:return 3;case 7:case 8:return 4;case 9:case 10:return 5;case 11:return 6}},p=function(e){var a=[1,4,6,9,11,13,16,18,21,23,25,28,30,33,35,37,40,42,45,47,49,52,54,57,59,61,64,66,69,71,73,76,78,81,83,85],t=-1!==a.indexOf(e)?!0:!1,r=0;return e>=0&&2>=e?r=.0625:e>=3&&14>=e?r=.125:e>=15&&26>=e?r=.25:e>=27&&38>=e?r=.5:e>=39&&50>=e?r=1:e>=51&&62>=e?r=2:e>=63&&74>=e?r=4:e>=75&&86>=e?r=8:e>=87&&98>=e&&(r=16),t&&(r*=Math.pow(2,1/12)),r},m=function(){for(var e=new Array(l),a=0;l>a;a++){var t={buffer:0,rate:1,loop:!1,start:0,end:0,volume:1};t.buffer=d(a),t.rate=p(a),e[a]=t}return e},f=function(){r(function(){a.isReady=!0})},h=function(){var e=[];angular.forEach(a.rirs,function(t,r){X.ajax(t.url,c,function(t,r){X.decode(X.get(),r,function(t){e.push(t),a.$apply(function(){a.progress=Math.floor(e.length/a.rirs.length*100),a.progressStyle.width=a.progress+"%"}),e.length===a.rirs.length&&(angular.forEach(i,function(a){X(a).module("reverb").preset(e)}),C("oscillator").module("reverb").preset(e),f())},function(){f()})},function(e,a){s("Error",400,"auto",!0,"<p><b>The loading of RIRs failed.</b></p>")})})};try{X("oneshot").setup({resources:u,settings:m(),timeout:c,success:function(e,t){a.isEnableOneshot=!0,0===a.rirs.length?f():h()},error:function(e,a){s("Error",400,"auto",!0,"<p><b>The loading of audio files failed.</b></p>")},progress:function(e){}})}catch(v){s("Error",400,"auto",!0,"<p><b>"+v.message+"</b></p>")}a.currentSoundSource="oscillator",a.selectedSoundSource="oscillator",a.isReady=!1,a.progress=0,a.progressStyle={width:a.progress+"%"},a.isSafari=function(){var e=navigator.userAgent.toLowerCase();return-1===e.indexOf("chrome")&&-1!==e.indexOf("safari")?!0:!1}(),a.isEnableOneshot=!1,a.isEndOpeing=!1,a.isStart=!1,a.headerStyle={top:parseInt(t.innerHeight/4)+"px"},a.isModalProgressDecodeAudio=!1,a.isModalProgressReadFile=!1,a.isModalProgressSessionWait=!1,a.oscillators={},a.oscillators.oscillator0={},a.oscillators.oscillator0.isActive=!0,a.oscillators.oscillator0.type="sine",a.oscillators.oscillator1={},a.oscillators.oscillator1.isActive=!1,a.oscillators.oscillator1.type="sine",a.readFileProgress="",a.rirs=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("firefox")?[]:[{url:o+"impulse-responses/s1_r1_c.wav",value:1,label:"1 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s1_r2_c.wav",value:2,label:"1 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s1_r3_c.wav",value:3,label:"1 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s1_r4_c.wav",value:4,label:"1 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s2_r1_c.wav",value:5,label:"2 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s2_r2_c.wav",value:6,label:"2 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s2_r3_c.wav",value:7,label:"2 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s2_r4_c.wav",value:8,label:"2 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s3_r1_c.wav",value:9,label:"3 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s3_r2_c.wav",value:10,label:"3 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s3_r3_c.wav",value:11,label:"3 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s3_r4_c.wav",value:12,label:"3 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:o+"impulse-responses/s1_r1_o.wav",value:13,label:"1 - 1",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s1_r2_o.wav",value:14,label:"1 - 2",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s1_r3_o.wav",value:15,label:"1 - 3",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s1_r4_o.wav",value:16,label:"1 - 4",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s2_r1_o.wav",value:17,label:"2 - 1",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s2_r2_o.wav",value:18,label:"2 - 2",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s2_r3_o.wav",value:19,label:"2 - 3",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s2_r4_o.wav",value:20,label:"2 - 4",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s3_r1_o.wav",value:21,label:"3 - 1",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s3_r2_o.wav",value:22,label:"3 - 2",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s3_r3_o.wav",value:23,label:"3 - 3",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s3_r4_o.wav",value:24,label:"3 - 4",group:"Omnidirectional measurements in the audience area"},{url:o+"impulse-responses/s1_p1_o.wav",value:25,label:"1 - 1",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s1_p2_o.wav",value:26,label:"1 - 2",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s1_p3_o.wav",value:27,label:"1 - 3",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s2_p1_o.wav",value:28,label:"2 - 1",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s2_p2_o.wav",value:29,label:"2 - 2",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s2_p3_o.wav",value:30,label:"2 - 3",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s3_p1_o.wav",value:31,label:"3 - 1",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s3_p2_o.wav",value:32,label:"3 - 2",group:"Omnidirectional measurements on the stage"},{url:o+"impulse-responses/s3_p3_o.wav",value:33,label:"3 - 3",group:"Omnidirectional measurements on the stage"}]}(),a.pianoKeyboards={},a.pianoKeyboards.keyboards={"A-4":0,"A-4h":1,"B-4":2,"C-3":3,"C-3h":4,"D-3":5,"D-3h":6,"E-3":7,"F-3":8,"F-3h":9,"G-3":10,"G-3h":11,"A-3":12,"A-3h":13,"B-3":14,"C-2":15,"C-2h":16,"D-2":17,"D-2h":18,"E-2":19,"F-2":20,"F-2h":21,"G-2":22,"G-2h":23,"A-2":24,"A-2h":25,"B-2":26,"C-1":27,"C-1h":28,"D-1":29,"D-1h":30,"E-1":31,"F-1":32,"F-1h":33,"G-1":34,"G-1h":35,"A-1":36,"A-1h":37,"B-1":38,C:39,Ch:40,D:41,Dh:42,E:43,F:44,Fh:45,G:46,Gh:47,A:48,Ah:49,B:50,C1:51,C1h:52,D1:53,D1h:54,E1:55,F1:56,F1h:57,G1:58,G1h:59,A1:60,A1h:61,B1:62,C2:63,C2h:64,D2:65,D2h:66,E2:67,F2:68,F2h:69,G2:70,G2h:71,A2:72,A2h:73,B2:74,C3:75,C3h:76,D3:77,D3h:78,E3:79,F3:80,F3h:81,G3:82,G3h:83,A3:84,A3h:85,B3:86,C4:87},a.pianoKeyboards.whites=["A-4","B-4","C-3","D-3","E-3","F-3","G-3","A-3","B-3","C-2","D-2","E-2","F-2","G-2","A-2","B-2","C-1","D-1","E-1","F-1","G-1","A-1","B-1","C","D","E","F","G","A","B","C1","D1","E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4"],a.pianoKeyboards.blacks=["A-4h","skip","C-3h","D-3h","skip","F-3h","G-3h","A-3h","skip","C-2h","D-2h","skip","F-2h","G-2h","A-2h","skip","C-1h","D-1h","skip","F-1h","G-1h","A-1h","skip","Ch","Dh","skip","Fh","Gh","Ah","skip","C1h","D1h","skip","F1h","G1h","A1h","skip","C2h","D2h","skip","F2h","G2h","A2h","skip","C3h","D3h","skip","F3h","G3h","A3h"],a.isSoundStops=[],angular.forEach(a.pianoKeyboards.keyboards,function(){a.isSoundStops.push(!0)}),a.startApplication=function(e){e.preventDefault(),a.isStart=!0,r(function(){a.isEndOpening=!0},2e3)},a.startSound=function(e,t){X.IS_XSOUND&&!$(e.currentTarget).hasClass("skip")&&("oscillator"===a.currentSoundSource?(X("oscillator").ready(0,0).start(X.toFrequencies(t)),C("oscillator").ready(0,0).start(X.toFrequencies(t)),X("mixer").mix([X("oscillator"),C("oscillator")]),X("mixer").module("recorder").start(),X("mixer").module("session").start()):(X("oneshot").ready(0,0).start(t),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()),a.isSoundStops[t]=!1)},a.stopSound=function(e,t){X.IS_XSOUND&&!$(e.currentTarget).hasClass("skip")&&(e.stopPropagation(),"oscillator"===a.currentSoundSource?(X("oscillator").stop(),C("oscillator").stop()):X("oneshot").stop(t),a.isSoundStops[t]=!0)},a.clearKeyboards=function(){angular.forEach(a.isSoundStops,function(e,t){a.isSoundStops[t]=!0})},a.toggleOscillatorState=function(e,t){var r=!a.oscillators["oscillator"+t].isActive;switch(t){case 0:X("oscillator",0).state(r);break;case 1:C("oscillator",0).state(r)}a.oscillators["oscillator"+t].isActive=r},a.toggleAnalyserState=function(t){e.isActives.visualization=!a.isActives.visualization,angular.forEach(i,function(a){"oscillator"!==a&&(X(a).module("analyser").domain("time").state(e.isActives.visualization),X(a).module("analyser").domain("fft").state(e.isActives.visualization))})},a.toggleMMLState=function(a){e.isActives.mml=!e.isActives.mml},a.togglePatchState=function(t){e.isActives.patch=!e.isActives.patch,e.isActives.patch&&$("#patch-container").colorbox({open:!0,inline:!0,href:"#patch-container",width:"600px",height:"480px",transition:"fade",speed:600,opacity:.6,fadeOut:600,returnFocus:!1,onOpen:function(){a.$broadcast("onOpenPatchDialog")},onCleanup:function(){r(function(){e.isActives.patch=!1})}})},a.changeWaveType=function(e,t,r){var o=[0,1,2,3];switch(t){case 0:angular.forEach(o,function(e){X("oscillator",e).param("type",r)});break;case 1:angular.forEach(o,function(e){C("oscillator",e).param("type",r)})}a.oscillators["oscillator"+t].type=r},a.triggerFileUploader=function(e){$(e.currentTarget).prev('[type="file"]').trigger("click")}}]),e.controller("AudioController",["$rootScope","$scope","$timeout","createTimeString",function(e,a,t,r){var o=function(e){t(function(){a.$parent.isModalProgressDecodeAudio=!0})},i=function(e){var o=e.duration;t(function(){a.$parent.isModalProgressDecodeAudio=!1,a.isActive=!1,a.duration=o,a.durationText=r(o),a.currentTimeText="00 : 00.00"})},s=function(e,r){X("audio").module("session").start(),t(function(){a.isActive=!0})},n=function(e,r){t(function(){a.isActive=!1})},l=function(o,i){t(function(){e.currentTime=i,a.currentTimeText=r(i)})},c=function(r,o){X("audio").module("analyser").domain("time-overview-L").update(0),X("audio").module("analyser").domain("time-overview-R").update(0),t(function(){a.isActive=!1,e.currentTime=0,a.currentTimeText="00 : 00.00"})};X("audio").setup({decode:o,ready:i,start:s,stop:n,update:l,ended:c}),a.currentTime=0,a.currentTimeText="00 : 00.00",a.duration=0,a.durationText="00 : 00.00",a.isActive=!1,a.controlAudio=function(e){X("audio").toggle(X("audio").param("currentTime"))}}]),e.controller("RecordController",["$scope","$timeout","sources","openDialog","createDateTimeString",function(e,a,t,r,o){var i=function(){$("<div />").html("<p><b>Start recording in the TRACK "+(e.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{START:function(){angular.forEach(t,function(a){"oscillator"!==a&&"audio"!==a&&(X(a).module("recorder").ready(e.activeTrack),"stream"===a&&X("stream").module("recorder").start());
}),a(function(){e.isActive=!0}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},s=function(){$("<div />").html("<p><b>Stop the recording. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{STOP:function(){angular.forEach(t,function(e){"oscillator"!==e&&"audio"!==e&&X(e).module("recorder").stop()}),a(function(){e.isActive=!1}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})};e.isActive=!1,e.tracks=[1,2,3,4],e.activeTrack=0,e.objectURL="",e.finename="",angular.forEach(t,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").setup(e.tracks.length)}),e.controlRecord=function(a){a.preventDefault(),e.isActive?s():i()},e.createWAVE=function(a){if(a.preventDefault(),!e.isActive){var t=2,r=16,o="blob",i=e.$parent.selectedSoundSource;if("oscillator"===i&&(i="mixer"),e.objectURL=X(i).module("recorder").create("all",r,t,o),e.objectURL){var s=new Audio(e.objectURL);s.setAttribute("controls",!1),s.play()}}},e.downloadWAVE=function(a){return e.isActive?void a.preventDefault():void(e.objectURL?e.filename="recorded-"+o()+".wav":(a.preventDefault(),r("Error",450,"auto",!0,"<p><b>The recorded sound data does not exists.</b></p>")))},e.clearTrack=function(a){a.preventDefault(),e.isActive||$("<div />").html("<p><b>Clear the TRACK "+(e.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{CLEAR:function(){angular.forEach(t,function(a){"oscillator"!==a&&"audio"!==a&&X(a).module("recorder").clear(e.activeTrack)}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})}}]),e.controller("VisualizationController",["$rootScope","$scope","$document","$timeout","sources","drawNodeCallback",function(e,a,t,r,o,i){a.api="canvas",a.channel="left",a.setRealTimeAnalyser=function(e,a){X(e).module("analyser").param({fftSize:2048,minDecibels:-100,maxDecibels:-30,smoothingTimeConstant:.1}),X(e).module("analyser").domain("time").setup(t[0].getElementById(a+"-time")).param({interval:500,shape:"line",wave:"rgba(0, 0, 255, 1.0)",font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:2,right:15,type:"uint"}),X(e).module("analyser").domain("fft").setup(t[0].getElementById(a+"-spectrum")).param({interval:500,shape:"rect",wave:"gradient",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:2,right:15,type:"uint",size:256})},a.setAnalyser=function(e){X("audio").module("analyser").domain("time-overview-L").setup(t[0].getElementById(e+"-time-overview-L")).state(!0).param({shape:"rect",wave:"canvas"===e?"gradient":"rgba(0, 0, 255, 1)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:.5,right:15}),X("audio").module("analyser").domain("time-overview-R").setup(t[0].getElementById(e+"-time-overview-R")).state(!0).param({shape:"rect",wave:"canvas"===e?"gradient":"rgba(0, 0, 255, 1)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:.5,right:15})},a.selectAPI=function(e){a.api=e,angular.forEach(o,function(t){"oscillator"!==t&&a.setRealTimeAnalyser(t,e)}),a.setAnalyser(e),X("audio").module("analyser").domain("time-overview-L").drag(function(e){i(r,e)}),X("audio").module("analyser").domain("time-overview-R").drag(function(e){i(r,e)})},a.toggleAnalyserChannel=function(e,t){e.preventDefault(),a.channel=t},a.selectAPI("canvas")}]),e.controller("MMLController",["$rootScope","$scope","$http","$timeout","BASE_URL","createDateTimeString",function(e,a,t,r,o,i){var s=[0,1,2,3],n=function(e,t){if("oscillator"===a.$parent.currentSoundSource&&X("mixer").mix([X("oscillator"),C("oscillator")]),"R"!==e.indexes[t]){var o=e.indexes[t];r(function(){a.$parent.isSoundStops[o]=!1})}},l=function(e,t){if("R"!==e.indexes[t]){var o=e.indexes[t];r(function(){a.isSoundStops[o]=!0})}},c=function(){angular.forEach(s,function(e){X("oscillator",e).state(!1),C("oscillator",e).state(!1)}),a.readyMML(),a.paused=!0,a.$parent.clearKeyboards()},u=function(e,a){switch(e){case"TEMPO":case"OCTAVE":case"NOTE":break;case"MML":}},d={start:n,stop:l,ended:c,error:u};X("mml").setup(d),C("mml").setup(d),a.paused=!0,a.mml="",a.dataURL="",a.filename="",a.error="",a.$watch(function(){return a.$parent.currentSoundSource},function(){a.readyMML()}),t.get(Math.floor(2*Math.random())?o+"mml/mml-foreverlove.txt":o+"mml/mml-tears.txt").success(function(e,t,r,o){a.mml=e,a.typeMML()}).error(function(e,a,t,r){}),a.typeMML=function(e){a.readyMML(),a.paused=!0},a.readyMML=function(){var e=a.mml.split(/\|+/);"oscillator"===a.$parent.currentSoundSource?(e.length>0&&(X("mml").ready(X("oscillator"),e[0]),C("mml").ready(C("oscillator"),[])),e.length>1&&C("mml").ready(C("oscillator"),e[1])):X("mml").ready(X("oneshot"),e)},a.controlMML=function(e){if(e.preventDefault(),X("mml").isSequences()){var t=X("mml").get();a.paused?("oscillator"===a.$parent.currentSoundSource?(angular.forEach(s,function(e){X("oscillator",e).state(!0),C("oscillator",e).state(!0)}),a.$parent.oscillators.oscillator0.isActive=!0,a.$parent.oscillators.oscillator1.isActive=!0,X("mml").get().length>0&&X("mml").start(0),C("mml").get().length>0&&C("mml").start(0),X("mixer").module("recorder").start(),X("mixer").module("session").start()):(angular.forEach(t,function(e,a){X("mml").start(a)}),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()),a.paused=!1):(X("mml").stop(),C("mml").stop(),angular.forEach(s,function(e){X("oscillator",e).state(!0),C("oscillator",e).state(!0)}),a.paused=!0)}},a.stopMML=function(e){X("mml").stop(),C("mml").stop(),a.readyMML(),a.paused=!0,a.$parent.clearKeyboards()},a.downloadMML=function(e){return 0===a.mml.trim().length?void e.preventDefault():(a.dataURL=X("mml").create(a.mml),void(a.filename="mml-"+i()+".txt"))}}]),e.controller("SessionController",["$scope","$location","$timeout","sources","openDialog",function(e,a,t,r,o){var i=!1,s="",n="";-1!==a.host().indexOf("localhost")?(i=!1,s="localhost",n=""):(i=!0,s="x-sound-server.herokuapp.com/",n="/app/websocket/");var l=function(a,r){o("Confirmation",800,"auto",!1,"<p><b>Connection to ("+r.url+") succeeded.</b></p>"),t(function(){e.isActive=!0})},c=function(a,r){o("Confirmation",400,"auto",!0,"<p><b>Connection closed.</b></p>"),t(function(){e.isActive=!1})},u=function(a,r){o("Error",400,"auto",!0,"<p><b>Server Error.</b></p>"),t(function(){e.isActive=!1})},d=function(){t(function(){e.$parent.isModalProgressSessionWait=!1,X("mixer").module("session").state()?e.isActive=!0:e.isActive=!1})},p=function(a){e.$parent.isModalProgressSessionWait=!0};e.isActive=!1,e.url="",e.toggleSessionState=function(a){if(e.isActive=!e.isActive,e.isActive)if(X("mixer").module("session").isConnected()&&X("oneshot").module("session").isConnected()&&X("audio").module("session").isConnected()&&X("stream").module("session").isConnected())angular.forEach(r,function(e){"oscillator"!==e&&X(e).module("session").state(!0,d,p)});else{var t={tls:i,host:s,port:8e3,path:n,open:l,close:c,error:u};try{angular.forEach(r,function(e){"oscillator"!==e&&(X(e).module("session").setup(t).state(!0,d,p),t.port++)})}catch(m){e.isActive=!1,o("Error",400,"auto",!0,"<p><b>"+m.message+"</b></p>")}}else angular.forEach(r,function(e){"oscillator"!==e&&X(e).module("session").state(!1,d,p)})}}]),e.controller("PatchController",["$rootScope","$scope","$http","$window","$location","$timeout","sources","openDialog","getCurrentPatches",function(e,a,t,r,o,i,s,n,l){var c=1e4,u=function(){return-1!==o.host().indexOf("localhost")?"http://localhost/~rilakkuma3xjapan/portfolio-x-sound-server/php/bootstrap.php":"https://weblike-curtaincall.ssl-lolipop.jp/portfolio-x-sound-server/php/bootstrap.php"}(),d=l(),p=function(){a.isDisabled=!0,t({method:"POST",url:u+"/account/delete",timeout:c,withCredentials:!0,params:"",data:{username:a.deleteAccounts.username,password:a.deleteAccounts.password,_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e,t,r,o){angular.isObject(e)&&(a.csrf=e.csrf,a.isAuth=e.isAuth,a.authedUsername=e.username,a.isAuth?angular.forEach(e.message,function(e){n("Error",400,"auto",!1,"<p><b>"+e+"</b></p>")}):angular.forEach(e.message,function(e){n("Confirmation",400,"auto",!1,"<p><b>"+e+"</b></p>")})),a.isDisabled=!1}).error(function(e,t,r,o){v(),a.isDisabled=!1})},m=function(e,t){if(angular.isObject(e)){var r=function(e,a){angular.forEach(s,function(t){X(t).module(e).state(a)}),C("oscillator").module(e).state(a),a?$('[effector="'+e+'"]').addClass("check-on"):$('[effector="'+e+'"]').removeClass("check-on")};if("mastervolume"in e&&$(".slider-mastervolume:not(:first)").slider("value",e.mastervolume),"glide"in e){var o=e.glide;"time"in o&&$(".slider-glide-time").slider("value",o.time)}if("envelopegenerator"in e){var n=e.envelopegenerator;"attack"in n&&$(".slider-envelopegenerator-attack").slider("value",n.attack),"decay"in n&&$(".slider-envelopegenerator-decay").slider("value",n.decay),"sustain"in n&&$(".slider-envelopegenerator-sustain").slider("value",n.sustain),"release"in n&&$(".slider-envelopegenerator-release").slider("value",n.release)}if("oscillator0"in e){var c=e.oscillator0;"state"in c&&i(function(){a.$parent.oscillators.oscillator0.isActive=!c,a.$parent.toggleOscillatorState(null,0)}),"type"in c&&i(function(){a.$parent.changeWaveType(null,0,c.type)}),"gain"in c&&$(".slider-volume:first").slider("value",c.gain),"octave"in c&&$(".slider-octave:first").slider("value",c.octave),"fine"in c&&$(".slider-fine:first").slider("value",c.fine)}if("oscillator1"in e){var u=e.oscillator1;"state"in u&&i(function(){a.$parent.oscillators.oscillator1.isActive=!u,a.$parent.toggleOscillatorState(null,1)}),"type"in u&&i(function(){a.$parent.changeWaveType(null,1,u.type)}),"gain"in u&&$(".slider-volume:last").slider("value",u.gain),"octave"in u&&$(".slider-octave:last").slider("value",u.octave),"fine"in u&&$(".slider-fine:last").slider("value",u.fine)}if("compressor"in e){var d=e.compressor;"state"in d&&r("compressor",d.state),"threshold"in d&&$(".slider-threshold").slider("value",d.threshold),"knee"in d&&$(".slider-knee").slider("value",d.knee),"ratio"in d&&$(".slider-ratio").slider("value",d.ratio),"attack"in d&&$(".slider-compressor-attack").slider("value",d.attack),"release"in d&&$(".slider-compressor-release").slider("value",d.release)}if("distortion"in e){var p=e.distortion;"state"in p&&r("distortion",p.state),"curve"in p&&$("#select-distortion-type").val(p.curve).trigger("change"),"samples"in p&&$("#select-distortion-sample").val("value",p.samples),"drive"in p&&$(".slider-distortion-drive").slider("value",p.drive),"color"in p&&$(".slider-distortion-color").slider("value",p.color),"tone"in p&&$(".slider-distortion-tone").slider("value",p.tone)}if("wah"in e){var m=e.wah;"state"in m&&r("wah",m.state),"cutoff"in m&&$(".slider-wah-cutoff").slider("value",m.cutoff),"depth"in m&&$(".slider-wah-depth").slider("value",m.depth),"rate"in m&&$(".slider-wah-rate").slider("value",m.rate),"resonance"in m&&$(".slider-wah-resonance").slider("value",m.resonance)}if("equalizer"in e){var f=e.equalizer;"state"in f&&r("equalizer",f.state),"bass"in f&&$(".slider-equalizer-bass").slider("value",f.bass),"middle"in f&&$(".slider-equalizer-middle").slider("value",f.middle),"treble"in f&&$(".slider-equalizer-treble").slider("value",f.treble),"presence"in f&&$(".slider-equalizer-presence").slider("value",f.presence)}if("filter"in e){var h=e.filter;"state"in h&&r("filter",h.state),"type"in h&&$("#select-filter-type").val(h.type).trigger("change"),"frequency"in h&&$(".slider-filter-cutoff").slider("value",h.frequency),"Q"in h&&$(".slider-filter-Q").slider("value",h.Q),"gain"in h&&$(".slider-filter-gain").slider("value",h.gain),"attack"in h&&$(".slider-filter-attack").slider("value",h.attack),"decay"in h&&$(".slider-filter-decay").slider("value",h.decay),"sustain"in h&&$(".slider-filter-sustain").slider("value",h.sustain),"release"in h&&$(".slider-filter-release").slider("value",h.release)}if("autopanner"in e){var v=e.autopanner;"state"in v&&r("autopanner",v.state),"depth"in v&&$(".slider-autopanner-depth").slider("value",v.depth),"rate"in v&&$(".slider-autopanner-rate").slider("value",v.rate)}if("tremolo"in e){var g=e.tremolo;"state"in g&&r("tremolo",g.state),"depth"in g&&$(".slider-tremolo-depth").slider("value",g.depth),"rate"in g&&$(".slider-tremolo-rate").slider("value",g.rate)}if("ringmodulator"in e){var b=e.ringmodulator;"state"in b&&r("ringmodulator",b.state),"depth"in b&&$(".slider-ringmodulator-depth").slider("value",b.depth),"rate"in b&&$(".slider-ringmodulator-rate").slider("value",b.rate)}if("phaser"in e){var y=e.phaser;"state"in y&&r("phaser",y.state),"stage"in y&&$(".select-phaser-stage").val(y.stage),"frequency"in y&&$(".slider-phaser-cutoff").slider("value",y.frequency),"depth"in y&&$(".slider-phaser-depth").slider("value",y.depth),"rate"in y&&$(".slider-phaser-rate").slider("value",y.rate),"mix"in y&&$(".slider-phaser-mix").slider("value",y.mix),"feedback"in y&&$(".slider-phaser-feedback").slider("value",y.feedback)}if("flanger"in e){var w=e.flanger;"state"in w&&r("flanger",w.state),"time"in w&&$(".slider-flanger-time").slider("value",w.time),"depth"in w&&$(".slider-flanger-depth").slider("value",w.depth),"rate"in w&&$(".slider-flanger-rate").slider("value",w.rate),"mix"in w&&$(".slider-flanger-mix").slider("value",w.mix),"tone"in w&&$(".slider-flanger-tone").slider("value",w.tone),"feedback"in w&&$(".slider-flanger-feedback").slider("value",w.feedback)}if("chorus"in e){var A=e.chorus;"state"in A&&r("chorus",A.state),"time"in A&&$(".slider-chorus-time").slider("value",A.time),"depth"in A&&$(".slider-chorus-depth").slider("value",A.depth),"rate"in A&&$(".slider-chorus-rate").slider("value",A.rate),"mix"in A&&$(".slider-chorus-mix").slider("value",A.mix),"tone"in A&&$(".slider-chorus-tone").slider("value",A.tone),"feedback"in A&&$(".slider-chorus-feedback").slider("value",A.feedback)}if("delay"in e){var S=e.delay;"state"in S&&r("delay",S.state),"time"in S&&$(".slider-delay-time").slider("value",S.time),"dry"in S&&$(".slider-delay-dry").slider("value",S.dry),"wet"in S&&$(".slider-delay-wet").slider("value",S.wet),"tone"in S&&$(".slider-delay-tone").slider("value",S.tone),"feedback"in S&&$(".slider-delay-feedback").slider("value",S.feedback)}if("reverb"in e){var x=e.reverb;"state"in x&&r("reverb",x.state),"dry"in x&&$(".slider-reverb-dry").slider("value",x.dry),"wet"in x&&$(".slider-reverb-wet").slider("value",x.wet),"tone"in x&&$(".slider-reverb-tone").slider("value",x.tone)}i(function(){a.currentPatches=l(),t&&history.pushState(l(),null)})}},f=function(e){t({method:"POST",url:u+"/patch/update",timeout:c,withCredentials:!0,params:"",data:{name:e,patch:angular.toJson(l()),_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e,t,r,o){i(function(){angular.isObject(e)&&(a.csrf=e.csrf,a.isAuth=e.isAuth,a.patchLists=angular.fromJson(e.patches),angular.forEach(e.message,function(e){n("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")}))})}).error(function(e,a,t,r){v()})},h=function(e){t({method:"POST",url:u+"/patch/delete",timeout:c,withCredentials:!0,params:"",data:{name:e,_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e,t,r,o){angular.isObject(e)&&(a.csrf=e.csrf,a.isAuth=e.isAuth,a.patchLists=angular.fromJson(e.patches),angular.forEach(e.message,function(e){n("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")}))}).error(function(e,a,t,r){v()})},v=function(){n("Error",500,"auto",!1,"<p><b>Connection to Server failed.</b></p>")};r.onpopstate=function(e){e.state?m(e.state,!1):m(d,!1)},a.isAuth=!1,a.isSignin=!0,a.isSignup=!1,a.isPatchList=!1,a.isSavePath=!1,a.isAccount=!1,a.isDisabled=!1,a.csrf="",a.signups={username:"",password:""},a.signins={username:"",password:""},a.deleteAccounts={username:"",password:""},a.authedUsername="",a.patchname="",a.patchLists=[],a.dialogPatchDetailId="dialog-patch-detail",a.isShowDialogPatchDetail=!1,a.$watch(function(){return a.isAuth},function(e){e?(a.signups={username:"",password:""},a.signins={username:"",password:""},a.currentPatches=l(),a.toggleAction(null,"patchList")):(a.deleteAccounts={username:"",password:""},a.currentPatches={},a.patches={},a.patchname="",a.patchLists=[],a.authedUsername="",a.isShowDialogPatchDetail=!1,a.toggleAction(null,"signin"))}),a.$on("onOpenPatchDialog",function(e){a.currentPatches=l()}),a.cancelClose=function(e){e.stopImmediatePropagation()},a.toggleAction=function(e,t){switch(null!==e&&e.preventDefault(),a.isSignin=!1,a.isSignup=!1,a.isPatchList=!1,a.isSavePatch=!1,a.isAccount=!1,t){case"signin":a.isSignin=!0;break;case"signup":a.isSignup=!0;break;case"patchList":a.isPatchList=!0;break;case"savePatch":a.isSavePatch=!0;break;case"account":a.isAccount=!0}},a.signin=function(e){e.preventDefault(),a.isDisabled=!0,t({method:"POST",url:u+"/account/signin",timeout:c,withCredentials:!0,params:"",data:{username:a.signins.username,password:a.signins.password,_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e,t,r,o){angular.isObject(e)&&(a.csrf=e.csrf,a.isAuth=e.isAuth,a.authedUsername=e.username,a.isAuth?a.patchLists=angular.fromJson(e.patches):angular.forEach(e.message,function(e){n("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})),a.isDisabled=!1}).error(function(e,t,r,o){v(),a.isDisabled=!1})},a.signup=function(e){e.preventDefault(),a.isDisabled=!0,t({method:"POST",url:u+"/account/signup",timeout:c,withCredentials:!0,params:"",data:{username:a.signups.username,password:a.signups.password,_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e,t,r,o){angular.isObject(e)&&(a.csrf=e.csrf,a.isAuth=e.isAuth,a.authedUsername=e.username,a.isAuth?angular.forEach(e.message,function(e){n("Confirmation",600,"auto",!1,"<p><b>"+e+"</b></p>")}):angular.forEach(e.message,function(e){n("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})),a.isDisabled=!1}).error(function(e,t,r,o){v(),a.isDisabled=!1})},a.signout=function(e){a.isDisabled=!0,t({method:"POST",url:u+"/account/signout",timeout:c,withCredentials:!0,params:"",data:{_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e,t,r,o){angular.isObject(e)&&(a.csrf=e.csrf,a.isAuth=e.isAuth,a.authedUsername=e.username),a.isDisabled=!1}).error(function(e,t,r,o){v(),a.isDisabled=!1})},a.deleteAccount=function(e){$("<div />").html('<p><b>Delete your account. OK ?<br /> <b class="dangerous">If you delete account, the all of patches that you saved are also deleted.</b></b></p>').dialog({title:"Confirmation",autoOpen:!0,show:"bounce",hide:"explode",modal:!1,width:650,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){p(),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},a.typePatchname=function(e){a.patchname=e.currentTarget.value},a.savePatch=function(e){a.isDisabled=!0,t({method:"POST",url:u+"/patch/add",timeout:c,withCredentials:!0,params:"",data:{name:a.patchname,patch:angular.toJson(l()),_csrf:a.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).success(function(e,t,r,o){angular.isObject(e)&&(a.csrf=e.csrf,a.isAuth=e.isAuth,angular.forEach(e.message,function(e){n("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")}),e.result&&(a.patchLists=angular.fromJson(e.patches))),a.isDisabled=!1}).error(function(e,t,r,o){v(),a.isDisabled=!1})},a.openPatchDetail=function(e,t){if(angular.isObject(t)&&angular.isObject(t.patch))a.patches=t.patch;else{if(!angular.isString(t.patch))return;var r=t.patch.replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&");a.patches=angular.fromJson(r)}a.isShowDialogPatchDetail=!0,$("#"+a.dialogPatchDetailId).dialog({title:t.name,autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:600,height:400,draggable:!0,resizable:!1,zIndex:9999,position:{my:"center top",at:"center top"},buttons:{LOAD:function(){m(a.patches,!0),$(this).dialog("close")},UPDATE:function(){$("<div />").html("<p><b>Update the patch. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:1e4,buttons:{OK:function(){f(t.name),$(this).dialog("close").dialog("destroy").remove(),$("#"+a.dialogPatchDetailId).dialog("close")},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},DELETE:function(){$("<div />").html("<p><b>Delete the patch. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:1e4,buttons:{OK:function(){h(t.name),$(this).dialog("close").dialog("destroy").remove(),$("#"+a.dialogPatchDetailId).dialog("close")},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},CLOSE:function(){$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy"),i(function(){a.isShowDialogPatchDetail=!1})}})},t({method:"GET",url:u,timeout:c,withCredentials:!0,params:"",headers:{}}).success(function(e,t,r,o){angular.isObject(e)&&e.result&&(a.isAuth=e.isAuth,a.csrf=e.csrf,a.authedUsername=e.username,a.isAuth&&(a.patchLists=angular.fromJson(e.patches)))}).error(function(e,a,t,r){v()})}])}();
//# sourceMappingURL=controller.min.js.map