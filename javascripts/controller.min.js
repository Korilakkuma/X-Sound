!function(){"use strict";var e=angular.module("xsound",["ngSanitize"]);e.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|data|blob):/)}]),e.factory("BASE_URL",["$location",function(e){return"localhost"===e.host()?e.protocol()+"://"+e.host()+"/~korilakkuma/GitHub/X-Sound/resources/":e.protocol()+"://"+e.host()+"/resources/"}]),e.value("sources",["mixer","oscillator","oneshot","audio","stream","noise"]),e.value("oscillatorNumbers",[0,1,2,3]),e.value("updateParamEachOscillator",function(e,a,t,o,r){switch(a){case 0:t?angular.forEach(e,function(e){X("oscillator",e).module(t).param(o,r)}):angular.forEach(e,function(e){X("oscillator",e).param(o,r)});break;case 1:t?angular.forEach(e,function(e){C("oscillator",e).module(t).param(o,r)}):angular.forEach(e,function(e){C("oscillator",e).param(o,r)})}}),e.value("updateParamOfModule",function(e,a,t,o){"oscillator"===e&&"envelopegenerator"===a?(X("oscillator").module("envelopegenerator").param(t,o),C("oscillator").module("envelopegenerator").param(t,o)):"analyser"===a&&"interval"===t?0<o?(X(e).module("analyser").domain("time").param("interval",o),X(e).module("analyser").domain("fft").param("interval",o)):(X(e).module("analyser").domain("time").param("interval","auto"),X(e).module("analyser").domain("fft").param("interval","auto")):(X(e).module(a).param(t,o),"oscillator"===e&&C("oscillator").module(a).param(t,o))}),e.value("updateParamOfSource",function(e,a,t){"oneshot"===e&&"playbackRate"===a?X("oneshot").param("transpose",t):(X(e).param(a,t),C("oscillator").param(a,t))}),e.factory("updateParam",["oscillatorNumbers","updateParamEachOscillator","updateParamOfModule","updateParamOfSource",function(s,i,n,l){return function(e,t,o,r){var a=[];a=e?e.split(" "):["mixer","oscillator","oneshot","audio","stream","noise"],angular.forEach(a,function(e){var a=e.match(/oscillator(0|1)/);null!==a?i(s,parseInt(a[1]),t,o,r):t?n(e,t,o,r):l(e,o,r)})}}]),e.value("openDialog",function(e,a,t,o,r){$("<div />").html(r).dialog({title:e,autoOpen:!0,show:"explode",hide:"explode",width:a,height:t,modal:o,draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){$(this).dialog("close").dialog("destroy").remove()}}})}),e.factory("readFile",["openDialog",function(t){return function(e){var a=null;try{a=X.file(e)}catch(e){t("Error",500,"auto",!0,"<p><b>"+e.message+"</b></p>")}return a}}]),e.factory("readFileByDragAndDrop",["readFile",function(o){return function(e,t){e.addEventListener("dragenter",function(e){e.preventDefault(),$(this).removeClass("drag-off").addClass("drag-on")}),e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("dragleave",function(e){$(this).removeClass("drag-on").addClass("drag-off")}),e.addEventListener("drop",function(e){$(this).removeClass("drag-on").addClass("drag-off"),t.event=e;var a=o(t);a instanceof Blob&&(this.value=a.name)})}}]),e.factory("readFileErrorCallback",["openDialog",function(t){return function(e){var a="";switch(e){case"FILE_IS_NOT_BLOB":a="The designated file is not Blob";break;case"NOT_FOUND_ERR":a="There is not file";break;case"SECURITY_ERR":a="Security error occurred";break;case"ABORT_ERR":a="Abort";break;case"NOT_READABLE_ERR":a="The authority to read file does not exists";break;case"ENCODING_ERR":a="FIle size exceeds limit";break;case"ERR":a="Error. Please try again."}t("Error",500,"auto",!0,"<p><b>"+a+"</b></p>")}}]),e.value("readFileProgressCallback",function(e,a,t){var o=0,r="";t.lengthComputable&&0<t.total&&(o=Math.floor(t.loaded/t.total*100),r=t.loaded+" Bytes load ("+o+" %)",a(function(){e.readFileProgress=r,e.isModalProgressReadFile||(e.isModalProgressReadFile=!0)}))}),e.factory("drawNodeCallback",["$rootScope",function(s){return function(e,a,t,o,r){"update"===a?0<=o&&o<=X("audio").param("duration")&&(X("audio").param("currentTime",o),X("audio").module("analyser").domain("time-overview-L").update(o),X("audio").module("analyser").domain("time-overview-R").update(o),e(function(){s.currentTime=o})):"sprite"!==a||"mouseup"!==t.type&&"touchend"!==t.type||X("audio").stop().start(o,r)}}]),e.value("createTimeString",function(e){var a=X.convertTime(e);return 0===a.milliseconds?("0"+a.minutes).slice(-2)+" : "+("0"+a.seconds).slice(-2)+".00":("0"+a.minutes).slice(-2)+" : "+("0"+a.seconds).slice(-2)+"."+String(a.milliseconds).slice(2,4)}),e.value("createDateTimeString",function(){var e=function(e){return("0"+e).slice(-2)},a=new Date;return a.getFullYear()+e(a.getMonth()+1)+e(a.getDate())+e(a.getHours())+e(a.getMinutes())+e(a.getSeconds())}),e.value("getCurrentPatches",function(){return{mastervolume:X("oscillator").params().mastervolume,glide:{type:X("oscillator").params().oscillator.glide.type,time:X("oscillator").params().oscillator.glide.time},oscillator0:X("oscillator").params().oscillator.oscillator0,oscillator1:C("oscillator").params().oscillator.oscillator0,envelopegenerator:{attack:X("oscillator").params().envelopegenerator.attack,decay:X("oscillator").params().envelopegenerator.decay,sustain:X("oscillator").params().envelopegenerator.sustain,release:X("oscillator").params().envelopegenerator.release},compressor:{state:X("oscillator").params().compressor.state,threshold:X("oscillator").params().compressor.threshold,knee:X("oscillator").params().compressor.knee,ratio:X("oscillator").params().compressor.ratio,attack:X("oscillator").params().compressor.attack,release:X("oscillator").params().compressor.release},distortion:{state:X("oscillator").params().distortion.state,curve:X("oscillator").params().distortion.curve,samples:X("oscillator").params().distortion.samples,drive:X("oscillator").params().distortion.drive,color:X("oscillator").params().distortion.color,tone:X("oscillator").params().distortion.tone},wah:{state:X("oscillator").params().wah.state,cutoff:X("oscillator").params().wah.cutoff,depth:X("oscillator").params().wah.depth,rate:X("oscillator").params().wah.rate,resonance:X("oscillator").params().wah.resonance},equalizer:{state:X("oscillator").params().equalizer.state,bass:X("oscillator").params().equalizer.bass,middle:X("oscillator").params().equalizer.middle,treble:X("oscillator").params().equalizer.treble,presence:X("oscillator").params().equalizer.presence},filter:{state:X("oscillator").params().filter.state,type:X("oscillator").params().filter.type,frequency:X("oscillator").params().filter.frequency,Q:X("oscillator").params().filter.Q,gain:X("oscillator").params().filter.gain,attack:X("oscillator").params().filter.attack,decay:X("oscillator").params().filter.decay,sustain:X("oscillator").params().filter.sustain,release:X("oscillator").params().filter.release},autopanner:{state:X("oscillator").params().autopanner.state,depth:X("oscillator").params().autopanner.depth,rate:X("oscillator").params().autopanner.rate},tremolo:{state:X("oscillator").params().tremolo.state,depth:X("oscillator").params().tremolo.depth,rate:X("oscillator").params().tremolo.rate},ringmodulator:{state:X("oscillator").params().ringmodulator.state,depth:X("oscillator").params().ringmodulator.depth,rate:X("oscillator").params().ringmodulator.rate},phaser:{state:X("oscillator").params().phaser.state,stage:X("oscillator").params().phaser.stage,frequency:X("oscillator").params().phaser.frequency,depth:X("oscillator").params().phaser.depth,rate:X("oscillator").params().phaser.rate,mix:X("oscillator").params().phaser.mix,feedback:X("oscillator").params().phaser.feedback},chorus:{state:X("oscillator").params().chorus.state,time:1e3*X("oscillator").params().chorus.time,depth:X("oscillator").params().chorus.depth,rate:X("oscillator").params().chorus.rate,mix:X("oscillator").params().chorus.mix,tone:X("oscillator").params().chorus.tone},flanger:{state:X("oscillator").params().flanger.state,time:1e3*X("oscillator").params().flanger.time,depth:X("oscillator").params().flanger.depth,rate:X("oscillator").params().flanger.rate,mix:X("oscillator").params().flanger.mix,tone:X("oscillator").params().flanger.tone,feedback:X("oscillator").params().flanger.feedback},delay:{state:X("oscillator").params().delay.state,time:1e3*X("oscillator").params().delay.time,dry:X("oscillator").params().delay.dry,wet:X("oscillator").params().delay.wet,tone:X("oscillator").params().delay.tone,feedback:X("oscillator").params().delay.feedback},reverb:{state:X("oscillator").params().reverb.state,dry:X("oscillator").params().reverb.dry,wet:X("oscillator").params().reverb.wet,tone:X("oscillator").params().reverb.tone}}}),e.run(["$rootScope","$window","sources","openDialog",function(e,a,t,o){if(X.IS_XSOUND){e.isActives={visualization:!1,sprite:!1,mml:!1,patch:!1},e.currentTime=0,a.C=X.clone(),X.free([X("media")]),C.free([C("oneshot"),C("noise"),C("audio"),C("media"),C("stream"),C("mixer"),C("midi")]),X("mixer").resize(1024),X("oscillator").resize(1024),C("oscillator").resize(1024),X("oneshot").resize(1024),X("audio").resize(8192),X("stream").resize(512),X("oscillator").setup([!0,!0,!0,!0]),C("oscillator").setup([!1,!1,!1,!1]),X("audio").module("wah").param("auto",!0),X("audio").module("pitchshifter").state(!0),X("stream").module("pitchshifter").state(!0);X("stream").setup({audio:{autoGainControl:!0,echoCancellation:!0,echoCancellationType:"system",noiseSuppression:!1},video:!1},function(e){},function(e){o("Confirmation",400,"auto",!0,"<p><b>Cancel Microphone.</b></p>")}),angular.forEach(t,function(e){X(e).module("distortion").param("color",2e3),X(e).module("distortion").param("tone",4e3),X(e).module("chorus").param("tone",4e3),X(e).module("flanger").param("tone",4e3),X(e).module("delay").param("tone",4e3),X(e).module("reverb").param("tone",4e3),X(e).module("filter").param("frequency",8e3)}),C("oscillator").module("distortion").param("color",2e3),C("oscillator").module("distortion").param("tone",4e3),C("oscillator").module("chorus").param("tone",4e3),C("oscillator").module("flanger").param("tone",4e3),C("oscillator").module("delay").param("tone",4e3),C("oscillator").module("reverb").param("tone",4e3),C("oscillator").module("filter").param("frequency",8e3);for(var r=0,s=X("oscillator").length();r<s;r++)X("oscillator",r).param("type","sawtooth"),C("oscillator",r).param("type","sawtooth");$("#twitter").socialbutton("twitter",{lang:"en_US"}),$("#facebook").socialbutton("facebook_like",{button:"button_count",locale:"en_US"}),$("#hatena").socialbutton("hatena"),$("#google").socialbutton("google_plusone",{size:"medium"}).width(72)}else o("Error",600,"auto",!0,"<p><b>Your Browser does not support Web Audio API. Please use Chrome, Opera, Firefox (Mac / Windows) or Safari (Mac).</b></p>")}]),e.directive("uiSlider",["updateParam",function(v){return{restrict:"E",template:"<div></div>",link:function(e,a,t,o,r){var s=t.value,i=t.min,n=t.max,l=t.step,c=t.range||"min",u=t.animate||"slow",p=t.source,d=t.module,h=t.param,m=d?d+"-"+h:h,f=function(o){v(p,d,h,o),$(".spinner-"+m).each(function(e,a){var t=$(a).parents("ui-spinner");t.attr("source")===p&&t.attr("module")===d&&("glide"!==d&&"time"===h&&(o*=Math.pow(10,3)),$(a).spinner("value",o))})};$(a).children("div").addClass("slider-"+m).slider({value:parseFloat(s),min:parseFloat(i),max:parseFloat(n),step:parseFloat(l),range:c,animate:u,change:function(e,a){var t=parseFloat(a.value);"glide"!==d&&"time"===h&&(t/=Math.pow(10,3)),f(t)},slide:function(e,a){var t=parseFloat(a.value);"glide"!==d&&"time"===h&&(t/=Math.pow(10,3)),f(t)}})}}}]),e.directive("uiSpinner",["updateParam",function(h){return{restrict:"E",template:"<input />",link:function(e,a,t,o,r){var s=t.value,i=t.min,n=t.max,l=t.step,c=t.source,u=t.module,p=t.param,d=u?u+"-"+p:p;$(a).children("input").addClass("spinner-"+d).spinner({min:parseFloat(i),max:parseFloat(n),step:parseFloat(l),spin:function(e,a){var o,t=parseFloat(a.value);"glide"!==u&&"time"===p&&(t/=Math.pow(10,3)),h(c,u,p,o=t),$(".slider-"+d).each(function(e,a){var t=$(a).parent("ui-slider");t.attr("source")===c&&t.attr("module")===u&&("glide"!==u&&"time"===p&&(o*=Math.pow(10,3)),$(a).slider("value",o))})}}).spinner("value",parseFloat(s))}}}]),e.directive("uiSliderTime",["$rootScope","$timeout","createTimeString",function(u,p,d){return{restrict:"E",template:"<div></div>",link:function(t,e,a,o,r){var s=a.value,i=a.max,n=a.step,l=a.range||"min",c=a.animate||"slow";$(e).children("div").attr("id","slider-audio-current-time").slider({value:parseFloat(s),min:0,max:parseFloat(i),step:parseFloat(n),range:l,animate:c,change:function(e,a){},slide:function(e,a){X("audio").param("currentTime",parseFloat(a.value)),X("audio").module("analyser").domain("time-overview-L").update(X("audio").param("currentTime")),X("audio").module("analyser").domain("time-overview-R").update(X("audio").param("currentTime")),p(function(){u.currentTime=X("audio").param("currentTime")})}}),t.$watch(function(){return t.duration},function(e){$("#slider-audio-current-time").slider("option","max",e),$("#spinner-audio-current-time").spinner("option","max",e)});t.$watch(function(){return u.currentTime},function(e){var a;a=e,$("#slider-audio-current-time").slider("value",a),$("#spinner-audio-current-time").spinner("value",a),t.currentTimeText=d(a)})}}}]),e.directive("uiSpinnerTime",["$rootScope","$timeout",function(l,c){return{restrict:"E",template:"<input />",link:function(e,a,t,o,r){var s=t.value,i=t.max,n=t.step;$(a).children("input").attr("id","spinner-audio-current-time").spinner({min:0,max:parseFloat(i),step:parseFloat(n),spin:function(e,a){X("audio").param("currentTime",parseFloat(a.value)),X("audio").module("analyser").domain("time-overview-L").update(X("audio").param("currentTime")),X("audio").module("analyser").domain("time-overview-R").update(X("audio").param("currentTime")),c(function(){l.currentTime=X("audio").param("currentTime")})}}).spinner("value",parseFloat(s))}}}]),e.directive("uiToggleEffector",["sources",function(n){return{restrict:"A",link:function(e,a,t,o,r){var s=t.effector,i=parseInt(t.state);0!==i&&1!==i||angular.forEach(n,function(e){X(e).module(s).state(Boolean(i)),C("oscillator").module(s).state(Boolean(i)),X(e).module(s).state()?$(a).addClass("check-on"):$(a).removeClass("check-on")}),$(a).on("click",function(){angular.forEach(n,function(e){X(e).module(s).state()?(X(e).module(s).state(!1),C("oscillator").module(s).state(!1),$(a).removeClass("check-on")):(X(e).module(s).state(!0),C("oscillator").module(s).state(!0),$(a).addClass("check-on"))})})}}}]),e.directive("uiModalProgress",["$window",function(s){return{restrict:"E",link:function(e,a,t,o,r){$(a).children("section").css("margin-top",s.innerHeight/2-80+"px")}}}]),e.directive("uiTooltip",function(){return{restrict:"A",link:function(e,a,t,o,r){$(a).tooltip({tooltipClass:"ui-tooltip-custom"})}}}),e.directive("uiSortable",function(){return{restrict:"A",link:function(e,a,t,o,r){$(a).sortable({axis:"x",cancel:"fieldset, :input, button, label, a, #piano",cursor:"move",opacity:.6})}}}),e.directive("uiSelect",["$timeout","sources","openDialog",function(c,r,s){return{restrict:"A",link:function(l,e,a,t,o){switch($(e).select2(),$(e).attr("id")){case"select-sound-source":$(e).on("change",function(){var e=this.value;switch(e){case"oscillator":X("stream").stop(),c(function(){l.currentSoundSource=e,l.selectedSoundSource=e});break;case"piano":case"guitar":case"electric-guitar":l.isEnableOneshot&&c(function(){l.currentSoundSource=e,l.selectedSoundSource=e}),X("stream").stop();break;case"whitenoise":case"pinknoise":case"browniannoise":X("stream").stop(),c(function(){l.currentSoundSource=e,l.selectedSoundSource=e});break;case"stream":try{X("stream").start(),X("stream").module("session").start(),c(function(){l.selectedSoundSource=e})}catch(e){s("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}break;case"midi":X("stream").stop();try{X("midi").setup(!0,function(e,a,t){var i=[],n=[];0<a.length&&(a[0].onmidimessage=function(e){switch(240&e.data[0]){case 144:!function(e,a){if(!(e<21||108<e||a<0||127<a)){var t=e-21,o=a/127;if("oscillator"===l.currentSoundSource){i.push(t),n[0]=X("oscillator",0).param("volume"),n[1]=C("oscillator",0).param("volume");for(var r=0,s=X("oscillator").length();r<s;r++)0!==r&&(X("oscillator",r).state(!0),C("oscillator",r).state(!0)),X("oscillator",r).param("volume",o),C("oscillator",r).param("volume",o);X("oscillator").ready(0,0).start(X.toFrequencies(i)),C("oscillator").ready(0,0).start(X.toFrequencies(i)),X("mixer").mix([X("oscillator"),C("oscillator")]),X("mixer").module("recorder").start(),X("mixer").module("session").start()}else X("oneshot").reset(t,"volume",o).ready(0,0).start(t),X("oneshot").module("recorder").start(),X("oneshot").module("session").start();c(function(){l.isSoundStops[t]=!1})}}(e.data[1],e.data[2]);break;case 128:!function(e,a){if(!(e<21||108<e||a<0||127<a)){var t=e-21;if("oscillator"===l.currentSoundSource){var o=i.indexOf(t);-1!==o&&i.splice(o,1),X("oscillator").stop(),C("oscillator").stop();for(var r=0,s=X("oscillator").length();r<s;r++)0!==r&&(X("oscillator",r).state(!1),C("oscillator",r).state(!1)),X("oscillator",r).param("volume",n[0]),C("oscillator",r).param("volume",n[1])}else X("oneshot").stop(t).reset(t,"volume",1);c(function(){l.isSoundStops[t]=!0})}}(e.data[1],e.data[2])}})},function(e){s("Error",400,"auto",!0,"<p><b>Cannot use Web MIDI API.</b></p>")})}catch(e){s("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}}});break;case"select-rec-track":$(e).on("change",function(){if(!l.isActive){var a=parseInt(this.value);c(function(){l.activeTrack=a}),angular.forEach(r,function(e){"oscillator"!==e&&(X(e).module("recorder").ready(a),"stream"===e&&X("stream").module("recorder").start())})}});break;case"select-visualization-api":$(e).on("change",function(){l.selectAPI(this.value)});break;case"select-distortion-type":$(e).on("change",function(){var a=this.value;angular.forEach(r,function(e){X(e).module("distortion").param("curve",a)})});break;case"select-distortion-sample":$(e).on("change",function(){var a=this.value;angular.forEach(r,function(e){X(e).module("distortion").param("samples",a)})});break;case"select-filter-type":$(e).on("change",function(){var a=this.value;angular.forEach(r,function(e){X(e).module("filter").param("type",a)})});break;case"select-phaser-stage":$(e).on("change",function(){var a=this.value;angular.forEach(r,function(e){X(e).module("phaser").param("stage",a)})});break;case"select-reverb-type":$(e).on("change",function(){var a=parseInt(this.value)-1;-1===a&&(a=null),angular.forEach(r,function(e){X(e).module("reverb").param("type",a)})})}}}}]),e.directive("slideBlock",["$rootScope",function(n){return{restrict:"A",link:function(e,a,t,o,r){var s="easeOutQuint",i=t.model;$(a).hide(),e.$watch(function(){return n.isActives},function(e){e[i]?$(a).slideDown(1e3,s):$(a).slideUp(1e3,s)},!0)}}}]),e.directive("audioUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(l,c,u,p,d){return{restrict:"A",link:function(t,o,e,a,r){var s=o[0],i={event:null,type:"ArrayBuffer",success:function(e,a){X("audio").ready.call(X("audio"),a),l(function(){t.$parent.isModalProgressReadFile=!1})},error:function(e,a){d(a)},progress:function(e){p(t.$parent,l,e)}};s.addEventListener("change",function(e){i.event=e;var a=c(i);this.value="",a instanceof Blob&&$(o).next('[type="text"]').val(a.name)},!1);var n=$(o).next('[type="text"]')[0];u(n,i)}}}]),e.directive("rirUploader",["$timeout","sources","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(l,c,u,p,d,h){return{restrict:"A",link:function(t,o,e,a,r){var s=o[0],i={event:null,type:"ArrayBuffer",success:function(e,a){angular.forEach(c,function(e){X(e).module("reverb").start.call(X(e).module("reverb"),a)}),l(function(){t.isModalProgressReadFile=!1})},error:function(e,a){h(a)},progress:function(e){d(t,l,e)}};s.addEventListener("change",function(e){i.event=e;var a=u(i);this.value="",a instanceof Blob&&$(o).next('[type="text"]').val(a.name)},!1);var n=$(o).next('[type="text"]')[0];p(n,i)}}}]),e.directive("mmlUploader",["$timeout","readFile","readFileByDragAndDrop","readFileProgressCallback","readFileErrorCallback",function(l,c,u,p,d){return{restrict:"A",link:function(o,t,e,a,r){var s=t[0],i={event:null,type:"Text",success:function(e,a){var t=function(){l(function(){o.mml=a,o.paused=!0,o.readyMML()})};""===o.mml?t():$("<div />").html("<p><b>MML already exists. Overwrite ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:500,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){t(),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}}),l(function(){o.$parent.isModalProgressReadFile=!1})},error:function(e,a){d(a)},progress:function(e){p(o.$parent,l,e)}};s.addEventListener("change",function(e){i.event=e;var a=c(i);this.value="",a instanceof Blob&&$(t).next('[type="text"]').val(a.name)},!1);var n=$(t).next('[type="text"]')[0];u(n,i)}}}]),e.controller("XSoundController",["$rootScope","$scope","$window","$timeout","BASE_URL","sources","oscillatorNumbers","openDialog","getCurrentPatches",function(a,o,e,t,r,s,i,n,l){var c,u=!1,p=[r+"one-shot/piano-2/C.wav",r+"one-shot/piano-2/D.wav",r+"one-shot/piano-2/E.wav",r+"one-shot/piano-2/F.wav",r+"one-shot/piano-2/G.wav",r+"one-shot/piano-2/A.wav",r+"one-shot/piano-2/B.wav",r+"one-shot/guitar/C.mp3",r+"one-shot/e-guitar/C.mp3"],d=function(e){switch(parseInt((e+9)%12)){case 0:case 1:return 0;case 2:case 3:return 1;case 4:return 2;case 5:case 6:return 3;case 7:case 8:return 4;case 9:case 10:return 5;case 11:return 6}},h=function(e){var a=0;switch(e-88){case 0:a=1*Math.pow(Math.pow(2,1/12),-39);break;case 1:a=1*Math.pow(Math.pow(2,1/12),-38);break;case 2:a=1*Math.pow(Math.pow(2,1/12),-37);break;case 3:a=1*Math.pow(Math.pow(2,1/12),-36);break;case 4:a=1*Math.pow(Math.pow(2,1/12),-35);break;case 5:a=1*Math.pow(Math.pow(2,1/12),-34);break;case 6:a=1*Math.pow(Math.pow(2,1/12),-33);break;case 7:a=1*Math.pow(Math.pow(2,1/12),-32);break;case 8:a=1*Math.pow(Math.pow(2,1/12),-31);break;case 9:a=1*Math.pow(Math.pow(2,1/12),-30);break;case 10:a=1*Math.pow(Math.pow(2,1/12),-29);break;case 11:a=1*Math.pow(Math.pow(2,1/12),-28);break;case 12:a=1*Math.pow(Math.pow(2,1/12),-27);break;case 13:a=1*Math.pow(Math.pow(2,1/12),-26);break;case 14:a=1*Math.pow(Math.pow(2,1/12),-25);break;case 15:a=1*Math.pow(Math.pow(2,1/12),-24);break;case 16:a=1*Math.pow(Math.pow(2,1/12),-23);break;case 17:a=1*Math.pow(Math.pow(2,1/12),-22);break;case 18:a=1*Math.pow(Math.pow(2,1/12),-21);break;case 19:a=1*Math.pow(Math.pow(2,1/12),-20);break;case 20:a=1*Math.pow(Math.pow(2,1/12),-19);break;case 21:a=1*Math.pow(Math.pow(2,1/12),-18);break;case 22:a=1*Math.pow(Math.pow(2,1/12),-17);break;case 23:a=1*Math.pow(Math.pow(2,1/12),-16);break;case 24:a=1*Math.pow(Math.pow(2,1/12),-15);break;case 25:a=1*Math.pow(Math.pow(2,1/12),-14);break;case 26:a=1*Math.pow(Math.pow(2,1/12),-13);break;case 27:a=1*Math.pow(Math.pow(2,1/12),-12);break;case 28:a=1*Math.pow(Math.pow(2,1/12),-11);break;case 29:a=1*Math.pow(Math.pow(2,1/12),-10);break;case 30:a=1*Math.pow(Math.pow(2,1/12),-9);break;case 31:a=1*Math.pow(Math.pow(2,1/12),-8);break;case 32:a=1*Math.pow(Math.pow(2,1/12),-7);break;case 33:a=1*Math.pow(Math.pow(2,1/12),-6);break;case 34:a=1*Math.pow(Math.pow(2,1/12),-5);break;case 35:a=1*Math.pow(Math.pow(2,1/12),-4);break;case 36:a=1*Math.pow(Math.pow(2,1/12),-3);break;case 37:a=1*Math.pow(Math.pow(2,1/12),-2);break;case 38:a=1*Math.pow(Math.pow(2,1/12),-1);break;case 39:a=1;break;case 40:a=1*Math.pow(Math.pow(2,1/12),1);break;case 41:a=1*Math.pow(Math.pow(2,1/12),2);break;case 42:a=1*Math.pow(Math.pow(2,1/12),3);break;case 43:a=1*Math.pow(Math.pow(2,1/12),4);break;case 44:a=1*Math.pow(Math.pow(2,1/12),5);break;case 45:a=1*Math.pow(Math.pow(2,1/12),6);break;case 46:a=1*Math.pow(Math.pow(2,1/12),7);break;case 47:a=1*Math.pow(Math.pow(2,1/12),8);break;case 48:a=1*Math.pow(Math.pow(2,1/12),9);break;case 49:a=1*Math.pow(Math.pow(2,1/12),10);break;case 50:a=1*Math.pow(Math.pow(2,1/12),11);break;case 51:a=1*Math.pow(Math.pow(2,1/12),12);break;case 52:a=1*Math.pow(Math.pow(2,1/12),13);break;case 53:a=1*Math.pow(Math.pow(2,1/12),14);break;case 54:a=1*Math.pow(Math.pow(2,1/12),15);break;case 55:a=1*Math.pow(Math.pow(2,1/12),16);break;case 56:a=1*Math.pow(Math.pow(2,1/12),17);break;case 57:a=1*Math.pow(Math.pow(2,1/12),18);break;case 58:a=1*Math.pow(Math.pow(2,1/12),19);break;case 59:a=1*Math.pow(Math.pow(2,1/12),20);break;case 60:a=1*Math.pow(Math.pow(2,1/12),21);break;case 61:a=1*Math.pow(Math.pow(2,1/12),22);break;case 62:a=1*Math.pow(Math.pow(2,1/12),23);break;case 63:a=1*Math.pow(Math.pow(2,1/12),24);break;case 64:a=1*Math.pow(Math.pow(2,1/12),25);break;case 65:a=1*Math.pow(Math.pow(2,1/12),26);break;case 66:a=1*Math.pow(Math.pow(2,1/12),27);break;case 67:a=1*Math.pow(Math.pow(2,1/12),28);break;case 68:a=1*Math.pow(Math.pow(2,1/12),29);break;case 69:a=1*Math.pow(Math.pow(2,1/12),30);break;case 70:a=1*Math.pow(Math.pow(2,1/12),31);break;case 71:a=1*Math.pow(Math.pow(2,1/12),33);break;case 77:a=1*Math.pow(Math.pow(2,1/12),34);break;case 78:a=1*Math.pow(Math.pow(2,1/12),35);break;case 79:a=1*Math.pow(Math.pow(2,1/12),36);break;case 80:a=1*Math.pow(Math.pow(2,1/12),37);break;case 81:a=1*Math.pow(Math.pow(2,1/12),38);break;case 82:a=1*Math.pow(Math.pow(2,1/12),39);break;case 83:a=1*Math.pow(Math.pow(2,1/12),40);break;case 84:a=1*Math.pow(Math.pow(2,1/12),41);break;case 85:a=1*Math.pow(Math.pow(2,1/12),42);break;case 86:a=1*Math.pow(Math.pow(2,1/12),43);break;case 87:a=1*Math.pow(Math.pow(2,1/12),44);break;case 88:a=1*Math.pow(Math.pow(2,1/12),45)}return a},m=function(e){var a=0;switch(e-88-88){case 0:a=1*Math.pow(Math.pow(2,1/12),-39);break;case 1:a=1*Math.pow(Math.pow(2,1/12),-38);break;case 2:a=1*Math.pow(Math.pow(2,1/12),-37);break;case 3:a=1*Math.pow(Math.pow(2,1/12),-36);break;case 4:a=1*Math.pow(Math.pow(2,1/12),-35);break;case 5:a=1*Math.pow(Math.pow(2,1/12),-34);break;case 6:a=1*Math.pow(Math.pow(2,1/12),-33);break;case 7:a=1*Math.pow(Math.pow(2,1/12),-32);break;case 8:a=1*Math.pow(Math.pow(2,1/12),-31);break;case 9:a=1*Math.pow(Math.pow(2,1/12),-30);break;case 10:a=1*Math.pow(Math.pow(2,1/12),-29);break;case 11:a=1*Math.pow(Math.pow(2,1/12),-28);break;case 12:a=1*Math.pow(Math.pow(2,1/12),-27);break;case 13:a=1*Math.pow(Math.pow(2,1/12),-26);break;case 14:a=1*Math.pow(Math.pow(2,1/12),-25);break;case 15:a=1*Math.pow(Math.pow(2,1/12),-24);break;case 16:a=1*Math.pow(Math.pow(2,1/12),-23);break;case 17:a=1*Math.pow(Math.pow(2,1/12),-22);break;case 18:a=1*Math.pow(Math.pow(2,1/12),-21);break;case 19:a=1*Math.pow(Math.pow(2,1/12),-20);break;case 20:a=1*Math.pow(Math.pow(2,1/12),-19);break;case 21:a=1*Math.pow(Math.pow(2,1/12),-18);break;case 22:a=1*Math.pow(Math.pow(2,1/12),-17);break;case 23:a=1*Math.pow(Math.pow(2,1/12),-16);break;case 24:a=1*Math.pow(Math.pow(2,1/12),-15);break;case 25:a=1*Math.pow(Math.pow(2,1/12),-14);break;case 26:a=1*Math.pow(Math.pow(2,1/12),-13);break;case 27:a=1*Math.pow(Math.pow(2,1/12),-12);break;case 28:a=1*Math.pow(Math.pow(2,1/12),-11);break;case 29:a=1*Math.pow(Math.pow(2,1/12),-10);break;case 30:a=1*Math.pow(Math.pow(2,1/12),-9);break;case 31:a=1*Math.pow(Math.pow(2,1/12),-8);break;case 32:a=1*Math.pow(Math.pow(2,1/12),-7);break;case 33:a=1*Math.pow(Math.pow(2,1/12),-6);break;case 34:a=1*Math.pow(Math.pow(2,1/12),-5);break;case 35:a=1*Math.pow(Math.pow(2,1/12),-4);break;case 36:a=1*Math.pow(Math.pow(2,1/12),-3);break;case 37:a=1*Math.pow(Math.pow(2,1/12),-2);break;case 38:a=1*Math.pow(Math.pow(2,1/12),-1);break;case 39:a=1;break;case 40:a=1*Math.pow(Math.pow(2,1/12),1);break;case 41:a=1*Math.pow(Math.pow(2,1/12),2);break;case 42:a=1*Math.pow(Math.pow(2,1/12),3);break;case 43:a=1*Math.pow(Math.pow(2,1/12),4);break;case 44:a=1*Math.pow(Math.pow(2,1/12),5);break;case 45:a=1*Math.pow(Math.pow(2,1/12),6);break;case 46:a=1*Math.pow(Math.pow(2,1/12),7);break;case 47:a=1*Math.pow(Math.pow(2,1/12),8);break;case 48:a=1*Math.pow(Math.pow(2,1/12),9);break;case 49:a=1*Math.pow(Math.pow(2,1/12),10);break;case 50:a=1*Math.pow(Math.pow(2,1/12),11);break;case 51:a=1*Math.pow(Math.pow(2,1/12),12);break;case 52:a=1*Math.pow(Math.pow(2,1/12),13);break;case 53:a=1*Math.pow(Math.pow(2,1/12),14);break;case 54:a=1*Math.pow(Math.pow(2,1/12),15);break;case 55:a=1*Math.pow(Math.pow(2,1/12),16);break;case 56:a=1*Math.pow(Math.pow(2,1/12),17);break;case 57:a=1*Math.pow(Math.pow(2,1/12),18);break;case 58:a=1*Math.pow(Math.pow(2,1/12),19);break;case 59:a=1*Math.pow(Math.pow(2,1/12),20);break;case 60:a=1*Math.pow(Math.pow(2,1/12),21);break;case 61:a=1*Math.pow(Math.pow(2,1/12),22);break;case 62:a=1*Math.pow(Math.pow(2,1/12),23);break;case 63:a=1*Math.pow(Math.pow(2,1/12),24);break;case 64:a=1*Math.pow(Math.pow(2,1/12),25);break;case 65:a=1*Math.pow(Math.pow(2,1/12),26);break;case 66:a=1*Math.pow(Math.pow(2,1/12),27);break;case 67:a=1*Math.pow(Math.pow(2,1/12),28);break;case 68:a=1*Math.pow(Math.pow(2,1/12),29);break;case 69:a=1*Math.pow(Math.pow(2,1/12),30);break;case 70:a=1*Math.pow(Math.pow(2,1/12),31);break;case 71:a=1*Math.pow(Math.pow(2,1/12),33);break;case 77:a=1*Math.pow(Math.pow(2,1/12),34);break;case 78:a=1*Math.pow(Math.pow(2,1/12),35);break;case 79:a=1*Math.pow(Math.pow(2,1/12),36);break;case 80:a=1*Math.pow(Math.pow(2,1/12),37);break;case 81:a=1*Math.pow(Math.pow(2,1/12),38);break;case 82:a=1*Math.pow(Math.pow(2,1/12),39);break;case 83:a=1*Math.pow(Math.pow(2,1/12),40);break;case 84:a=1*Math.pow(Math.pow(2,1/12),41);break;case 85:a=1*Math.pow(Math.pow(2,1/12),42);break;case 86:a=1*Math.pow(Math.pow(2,1/12),43);break;case 87:a=1*Math.pow(Math.pow(2,1/12),44);break;case 88:a=1*Math.pow(Math.pow(2,1/12),45)}return a},f=function(){t(function(){o.isReady=!0})};try{X("oneshot").setup({resources:p,settings:function(){for(var e,a,t=new Array(88),o=0;o<88;o++)(r={buffer:0,rate:1,loop:!1,start:0,end:0,volume:1}).buffer=d(o),r.rate=(a=void 0,(a=0)<=(e=o)&&e<=2?a=.0625:3<=e&&e<=14?a=.125:15<=e&&e<=26?a=.25:27<=e&&e<=38?a=.5:39<=e&&e<=50?a=1:51<=e&&e<=62?a=2:63<=e&&e<=74?a=4:75<=e&&e<=86?a=8:87<=e&&e<=98&&(a=16),-1!==[1,4,6,9,11,13,16,18,21,23,25,28,30,33,35,37,40,42,45,47,49,52,54,57,59,61,64,66,69,71,73,76,78,81,83,85].indexOf(e)&&(a*=Math.pow(2,1/12)),a),t[o]=r;for(o=88;o<176;o++)(r={buffer:7,rate:1,loop:!1,start:0,end:0,volume:1}).rate=h(o),t[o]=r;for(o=176;o<264;o++){var r;(r={buffer:8,rate:1,loop:!1,start:0,end:0,volume:1}).rate=m(o),t[o]=r}return t}(),timeout:6e4,success:function(e,a){var t;o.isEnableOneshot=!0,0===o.rirs.length?f():(t=[],angular.forEach(o.rirs,function(e,a){X.ajax(e.url,"arraybuffer",6e4,function(e,a){X.decode(X.get(),a,function(e){t.push(e),o.$apply(function(){o.progress=Math.floor(t.length/o.rirs.length*100),o.progressStyle.width=o.progress+"%"}),t.length===o.rirs.length&&(angular.forEach(s,function(e){X(e).module("reverb").preset(t)}),C("oscillator").module("reverb").preset(t),f())},function(e){f()})},function(e,a){n("Error",400,"auto",!0,"<p><b>The loading of RIRs failed.</b></p>")})}))},error:function(e,a){n("Error",400,"auto",!0,"<p><b>The loading of audio files failed.</b></p>")},progress:function(e){}})}catch(e){n("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}o.currentSoundSource="oscillator",o.selectedSoundSource="oscillator",o.isReady=!1,o.progress=0,o.progressStyle={width:o.progress+"%"},o.isSafari=-1===(c=navigator.userAgent.toLowerCase()).indexOf("chrome")&&-1!==c.indexOf("safari"),o.isEnableOneshot=!1,o.isEndOpeing=!1,o.isStart=!1,o.progressWrapperStyle={padding:Math.floor(e.innerHeight/2)-60+"px 0px"},o.headerStyle={top:parseInt(e.innerHeight/4)+"px"},o.isModalProgressDecodeAudio=!1,o.isModalProgressReadFile=!1,o.isModalProgressSessionWait=!1,o.oscillators={},o.oscillators.oscillator0={},o.oscillators.oscillator0.isActive=!0,o.oscillators.oscillator0.type="sawtooth",o.oscillators.oscillator1={},o.oscillators.oscillator1.isActive=!1,o.oscillators.oscillator1.type="sawtooth",o.readFileProgress="",o.rirs=[{url:r+"impulse-responses/s1_r1_c.wav",value:1,label:"1 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s1_r2_c.wav",value:2,label:"1 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s1_r3_c.wav",value:3,label:"1 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s1_r4_c.wav",value:4,label:"1 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s2_r1_c.wav",value:5,label:"2 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s2_r2_c.wav",value:6,label:"2 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s2_r3_c.wav",value:7,label:"2 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s2_r4_c.wav",value:8,label:"2 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s3_r1_c.wav",value:9,label:"3 - 1",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s3_r2_c.wav",value:10,label:"3 - 2",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s3_r3_c.wav",value:11,label:"3 - 3",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s3_r4_c.wav",value:12,label:"3 - 4",group:"Sideways pointed cardioid measurements in the audience area"},{url:r+"impulse-responses/s1_r1_o.wav",value:13,label:"1 - 1",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s1_r2_o.wav",value:14,label:"1 - 2",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s1_r3_o.wav",value:15,label:"1 - 3",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s1_r4_o.wav",value:16,label:"1 - 4",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s2_r1_o.wav",value:17,label:"2 - 1",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s2_r2_o.wav",value:18,label:"2 - 2",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s2_r3_o.wav",value:19,label:"2 - 3",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s2_r4_o.wav",value:20,label:"2 - 4",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s3_r1_o.wav",value:21,label:"3 - 1",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s3_r2_o.wav",value:22,label:"3 - 2",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s3_r3_o.wav",value:23,label:"3 - 3",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s3_r4_o.wav",value:24,label:"3 - 4",group:"Omnidirectional measurements in the audience area"},{url:r+"impulse-responses/s1_p1_o.wav",value:25,label:"1 - 1",group:"Omnidirectional measurements on the stage"},{url:r+"impulse-responses/s1_p2_o.wav",value:26,label:"1 - 2",group:"Omnidirectional measurements on the stage"},{url:r+"impulse-responses/s1_p3_o.wav",value:27,label:"1 - 3",group:"Omnidirectional measurements on the stage"},{url:r+"impulse-responses/s2_p1_o.wav",value:28,label:"2 - 1",group:"Omnidirectional measurements on the stage"},{url:r+"impulse-responses/s2_p2_o.wav",value:29,label:"2 - 2",group:"Omnidirectional measurements on the stage"},{url:r+"impulse-responses/s2_p3_o.wav",value:30,label:"2 - 3",group:"Omnidirectional measurements on the stage"},{url:r+"impulse-responses/s3_p1_o.wav",value:31,label:"3 - 1",group:"Omnidirectional measurements on the stage"},{url:r+"impulse-responses/s3_p2_o.wav",value:32,label:"3 - 2",group:"Omnidirectional measurements on the stage"},{url:r+"impulse-responses/s3_p3_o.wav",value:33,label:"3 - 3",group:"Omnidirectional measurements on the stage"}],o.pianoKeyboards={},o.pianoKeyboards.keyboards={"A-4":0,"A-4h":1,"B-4":2,"C-3":3,"C-3h":4,"D-3":5,"D-3h":6,"E-3":7,"F-3":8,"F-3h":9,"G-3":10,"G-3h":11,"A-3":12,"A-3h":13,"B-3":14,"C-2":15,"C-2h":16,"D-2":17,"D-2h":18,"E-2":19,"F-2":20,"F-2h":21,"G-2":22,"G-2h":23,"A-2":24,"A-2h":25,"B-2":26,"C-1":27,"C-1h":28,"D-1":29,"D-1h":30,"E-1":31,"F-1":32,"F-1h":33,"G-1":34,"G-1h":35,"A-1":36,"A-1h":37,"B-1":38,C:39,Ch:40,D:41,Dh:42,E:43,F:44,Fh:45,G:46,Gh:47,A:48,Ah:49,B:50,C1:51,C1h:52,D1:53,D1h:54,E1:55,F1:56,F1h:57,G1:58,G1h:59,A1:60,A1h:61,B1:62,C2:63,C2h:64,D2:65,D2h:66,E2:67,F2:68,F2h:69,G2:70,G2h:71,A2:72,A2h:73,B2:74,C3:75,C3h:76,D3:77,D3h:78,E3:79,F3:80,F3h:81,G3:82,G3h:83,A3:84,A3h:85,B3:86,C4:87},o.pianoKeyboards.whites=["A-4","B-4","C-3","D-3","E-3","F-3","G-3","A-3","B-3","C-2","D-2","E-2","F-2","G-2","A-2","B-2","C-1","D-1","E-1","F-1","G-1","A-1","B-1","C","D","E","F","G","A","B","C1","D1","E1","F1","G1","A1","B1","C2","D2","E2","F2","G2","A2","B2","C3","D3","E3","F3","G3","A3","B3","C4"],o.pianoKeyboards.blacks=["A-4h","skip","C-3h","D-3h","skip","F-3h","G-3h","A-3h","skip","C-2h","D-2h","skip","F-2h","G-2h","A-2h","skip","C-1h","D-1h","skip","F-1h","G-1h","A-1h","skip","Ch","Dh","skip","Fh","Gh","Ah","skip","C1h","D1h","skip","F1h","G1h","A1h","skip","C2h","D2h","skip","F2h","G2h","A2h","skip","C3h","D3h","skip","F3h","G3h","A3h"],o.isSoundStops=[],angular.forEach(o.pianoKeyboards.keyboards,function(){o.isSoundStops.push(!0)}),o.startApplication=function(e){e.preventDefault(),o.isStart=!0,t(function(){o.isEndOpening=!0},2e3)},o.startSound=function(e,a){X.IS_XSOUND&&!$(e.currentTarget).hasClass("skip")&&("mouseover"!==e.type||u)&&("oscillator"===o.currentSoundSource?(X("oscillator").ready(0,0).start(X.toFrequencies(a)),C("oscillator").ready(0,0).start(X.toFrequencies(a)),X("mixer").mix([X("oscillator"),C("oscillator")]),X("mixer").module("recorder").start(),X("mixer").module("session").start()):"piano"===o.currentSoundSource?(X("oneshot").ready(0,0).start(a),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()):"guitar"===o.currentSoundSource?(X("oneshot").ready(0,0).start(a+88),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()):"electric-guitar"===o.currentSoundSource?(X("oneshot").ready(0,0).start(a+88+88),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()):"whitenoise"===o.currentSoundSource?(X("noise").param("type","whitenoise").start(),X("noise").module("recorder").start(),X("noise").module("session").start()):"pinknoise"===o.currentSoundSource?(X("noise").param("type","pinknoise").start(),X("noise").module("recorder").start(),X("noise").module("session").start()):"browniannoise"===o.currentSoundSource&&(X("noise").param("type","browniannoise").start(),X("noise").module("recorder").start(),X("noise").module("session").start()),o.isSoundStops[a]=!1,u=!0)},o.stopSound=function(e,a){X.IS_XSOUND&&!$(e.currentTarget).hasClass("skip")&&(e.stopPropagation(),"oscillator"===o.currentSoundSource?(X("oscillator").stop(),C("oscillator").stop()):"piano"===o.currentSoundSource?X("oneshot").stop(a):"guitar"===o.currentSoundSource?X("oneshot").stop(a+88):"electric-guitar"===o.currentSoundSource?X("oneshot").stop(a+88+88):X("noise").stop(),o.isSoundStops[a]=!0,"mouseup"===e.type&&(u=!1))},o.clearKeyboards=function(){angular.forEach(o.isSoundStops,function(e,a){o.isSoundStops[a]=!0})},o.toggleOscillatorState=function(e,a){var t=!o.oscillators["oscillator"+a].isActive;switch(a){case 0:angular.forEach([0,1,2,3],function(e){X("oscillator").get(e).state(t)});break;case 1:angular.forEach([0,1,2,3],function(e){C("oscillator").get(e).state(t)})}o.oscillators["oscillator"+a].isActive=t},o.toggleAnalyserState=function(e){a.isActives.visualization=!o.isActives.visualization,angular.forEach(s,function(e){"oscillator"!==e&&(X(e).module("analyser").domain("time").state(a.isActives.visualization),X(e).module("analyser").domain("fft").state(a.isActives.visualization))})},o.toggleMMLState=function(e){a.isActives.mml=!a.isActives.mml},o.togglePatchState=function(e){a.isActives.patch=!a.isActives.patch,a.isActives.patch&&$("#patch-container").colorbox({open:!0,inline:!0,href:"#patch-container",width:"600px",height:"480px",transition:"fade",speed:600,opacity:.6,fadeOut:600,returnFocus:!1,onOpen:function(){o.$broadcast("onOpenPatchDialog")},onCleanup:function(){t(function(){a.isActives.patch=!1})}})},o.changeWaveType=function(e,a,t){switch(a){case 0:angular.forEach(i,function(e){X("oscillator",e).param("type",t)});break;case 1:angular.forEach(i,function(e){C("oscillator",e).param("type",t)})}o.oscillators["oscillator"+a].type=t},o.triggerFileUploader=function(e){$(e.currentTarget).prev('[type="file"]').trigger("click")}}]),e.controller("AudioController",["$rootScope","$scope","$timeout","createTimeString",function(t,o,r,s){X("audio").setup({decode:function(e){r(function(){o.$parent.isModalProgressDecodeAudio=!0})},ready:function(e){var a=e.duration;r(function(){o.$parent.isModalProgressDecodeAudio=!1,o.isActive=!1,o.duration=a,o.durationText=s(a),o.currentTimeText="00 : 00.00"})},start:function(e,a){X("audio").module("recorder").start(),X("audio").module("session").start(),r(function(){o.isActive=!0})},stop:function(e,a){r(function(){o.isActive=!1})},update:function(e,a){Math.floor(a*e.buffer.sampleRate)%(.1*e.buffer.sampleRate)==0&&r(function(){t.currentTime=a,o.currentTimeText=s(a)})},ended:function(e,a){X("audio").module("analyser").domain("time-overview-L").update(0),X("audio").module("analyser").domain("time-overview-R").update(0),r(function(){o.isActive=!1,t.currentTime=0,o.currentTimeText="00 : 00.00"})}}),o.currentTime=0,o.currentTimeText="00 : 00.00",o.duration=0,o.durationText="00 : 00.00",o.isActive=!1,o.controlAudio=function(e){X("audio").toggle(X("audio").param("currentTime"))}}]),e.controller("RecordController",["$scope","$timeout","sources","openDialog","createDateTimeString",function(o,a,t,r,s){o.isActive=!1,o.tracks=[1,2,3,4],o.activeTrack=0,o.objectURL="",o.finename="",angular.forEach(t,function(e){"oscillator"!==e&&X(e).module("recorder").setup(o.tracks.length)}),o.controlRecord=function(e){e.preventDefault(),o.isActive?$("<div />").html("<p><b>Stop the recording. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{STOP:function(){angular.forEach(t,function(e){"oscillator"!==e&&X(e).module("recorder").stop()}),a(function(){o.isActive=!1}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}}):$("<div />").html("<p><b>Start recording in the TRACK "+(o.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{START:function(){angular.forEach(t,function(e){"oscillator"!==e&&(X(e).module("recorder").ready(o.activeTrack),"stream"===e&&X("stream").module("recorder").start())}),a(function(){o.isActive=!0}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},o.createWAVE=function(e){if(e.preventDefault(),!o.isActive){angular.forEach(t,function(e){if("oscillator"!==e){var a=X(e).module("recorder").create("all",16,2,"objectURL");if(a){o.objectURL=a;var t=new Audio(o.objectURL);t.setAttribute("controls",!1),t.play()}}})}},o.downloadWAVE=function(e){o.isActive?e.preventDefault():o.objectURL?o.filename="recorded-"+s()+".wav":(e.preventDefault(),r("Error",450,"auto",!0,"<p><b>The recorded sound data does not exists.</b></p>"))},o.clearTrack=function(e){e.preventDefault(),o.isActive||$("<div />").html("<p><b>Clear the TRACK "+(o.activeTrack+1)+" . OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!0,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{CLEAR:function(){angular.forEach(t,function(e){"oscillator"!==e&&X(e).module("recorder").clear(o.activeTrack)}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})}}]),e.controller("VisualizationController",["$rootScope","$scope","$document","$timeout","sources","drawNodeCallback",function(e,t,o,r,s,i){t.api="canvas",t.channel="left",t.setRealTimeAnalyser=function(e,a){X(e).module("analyser").param({fftSize:2048,minDecibels:-100,maxDecibels:-30,smoothingTimeConstant:.1}),X(e).module("analyser").domain("time").setup(o[0].getElementById(a+"-time")).param({interval:0,shape:"line",wave:"rgba(0, 0, 255, 1.0)",font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:2,right:15,type:"uint"}),X(e).module("analyser").domain("fft").setup(o[0].getElementById(a+"-spectrum")).param({interval:0,shape:"rect",wave:"gradient",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:1,right:15,type:"uint",size:256})},t.setAnalyser=function(e){X("audio").module("analyser").domain("time-overview-L").setup(o[0].getElementById(e+"-time-overview-L")).state(!0).param({shape:"rect",wave:"canvas"===e?"gradient":"rgba(0, 0, 255, 1)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:.5,right:15}),X("audio").module("analyser").domain("time-overview-R").setup(o[0].getElementById(e+"-time-overview-R")).state(!0).param({shape:"rect",wave:"canvas"===e?"gradient":"rgba(0, 0, 255, 1)",grad:[{offset:0,color:"rgba(0, 128, 255, 1.0)"},{offset:1,color:"rgba(0,   0, 255, 1.0)"}],font:{family:"Arial",size:"12px",style:"normal",weight:"normal"},width:.5,right:15})},t.toggleSpriteMode=function(){e.isActives.sprite?(e.isActives.sprite=!1,r(function(){X("audio").module("analyser").domain("time-overview-L").param("mode","update"),X("audio").module("analyser").domain("time-overview-R").param("mode","update"),X("audio").param("loop",!1)})):(e.isActives.sprite=!0,r(function(){X("audio").module("analyser").domain("time-overview-L").param("mode","sprite"),X("audio").module("analyser").domain("time-overview-R").param("mode","sprite"),X("audio").param("loop",!0)}))},t.selectAPI=function(a){t.api=a,angular.forEach(s,function(e){"oscillator"!==e&&t.setRealTimeAnalyser(e,a)}),t.setAnalyser(a),X("audio").module("analyser").domain("time-overview-L").drag(function(e,a,t){i(r,X("audio").module("analyser").domain("time-overview-L").param("mode"),e,a,t)}),X("audio").module("analyser").domain("time-overview-R").drag(function(e,a,t){i(r,X("audio").module("analyser").domain("time-overview-R").param("mode"),e,a,t)})},t.toggleAnalyserChannel=function(e,a){e.preventDefault(),t.channel=a},t.selectAPI("canvas")}]),e.controller("MMLController",["$rootScope","$scope","$document","$http","$timeout","$sce","BASE_URL","oscillatorNumbers","createDateTimeString",function(e,o,r,a,s,t,i,n,l){var c=function(e){e.indexes.forEach(function(e){"R"!==e&&s(function(){o.$parent.isSoundStops[e]=!0})})},u=function(){angular.forEach(n,function(e){0!==e&&(X("oscillator",e).state(!1),C("oscillator",e).state(!1))}),o.readyMML(),o.paused=!0,o.$parent.clearKeyboards()},p=function(e,a){e};X("mml").setup({start:function(e){"oscillator"===o.$parent.currentSoundSource&&X("mixer").mix([X("oscillator"),C("oscillator")]);var a=o.mml.split(/\|+/);if(2===a.length){var t=a[0].replace(" "+e.note,' <span class="highlight">'+e.note+"</span>");o.mml=t+"|||||"+a[1]}else 1===a.length&&(t=a[0].replace(" "+e.note,' <span class="highlight">'+e.note+"</span>"),o.mml=t);r[0].querySelector("[contentEditable]").innerHTML=o.mml,angular.forEach(e.indexes,function(e){"R"!==e&&s(function(){o.$parent.isSoundStops[e]=!1})})},stop:c,ended:u,error:p}),C("mml").setup({start:function(e){var a=o.mml.split(/\|+/);if(2===a.length){var t=a[1].replace(" "+e.note,' <span class="highlight">'+e.note+"</span>");o.mml=a[0]+"|||||"+t,r[0].querySelector("[contentEditable]").innerHTML=o.mml}angular.forEach(e.indexes,function(e){"R"!==e&&s(function(){o.$parent.isSoundStops[e]=!1})})},stop:c,ended:u,error:p}),o.paused=!0,o.mml="",o.dataURL="",o.filename="",o.error="",o.trustAsHtml=function(e){return t.trustAsHtml(e)},o.$watch(function(){return o.$parent.currentSoundSource},function(){o.readyMML()}),a.get(Math.floor(2*Math.random())?i+"mml/mml-foreverlove.txt":i+"mml/mml-tears.txt").then(function(e){o.mml=e.data,r[0].querySelector("[contentEditable]").textContent=o.mml,o.readyMML(),o.paused=!0}).catch(function(e){}),o.typeMML=function(e){o.mml=e.currentTarget.textContent,r[0].querySelector("[contentEditable]").textContent=o.mml,o.readyMML(),o.paused=!0},o.readyMML=function(){var e=o.mml.split(/\|+/);"oscillator"===o.$parent.currentSoundSource?1<e.length?(X("mml").ready(X("oscillator"),e[0]),C("mml").ready(C("oscillator"),e[1])):0<e.length&&(X("mml").ready(X("oscillator"),e[0]),C("mml").ready(C("oscillator"),[])):"piano"===o.$parent.currentSoundSource?1<e.length?(X("mml").ready(X("oneshot"),e[0],0),C("mml").ready(X("oneshot"),e[1],0)):0<e.length&&(X("mml").ready(X("oneshot"),e[0],0),C("mml").ready(X("oneshot"),[],0)):"guitar"===o.$parent.currentSoundSource?1<e.length?(X("mml").ready(X("oneshot"),e[0],88),C("mml").ready(X("oneshot"),e[1],88)):0<e.length&&(X("mml").ready(X("oneshot"),e[0],88),C("mml").ready(X("oneshot"),[],88)):"electric-guitar"===o.$parent.currentSoundSource?1<e.length?(X("mml").ready(X("oneshot"),e[0],176),C("mml").ready(X("oneshot"),e[1],176)):0<e.length&&(X("mml").ready(X("oneshot"),e[0],176),C("mml").ready(X("oneshot"),[],176)):-1!==o.$parent.currentSoundSource.indexOf("noise")&&(1<e.length?(X("mml").ready(X("noise"),e[0]),C("mml").ready(C("noise"),e[1])):0<e.length&&(X("mml").ready(X("noise"),e[0]),C("mml").ready(C("noise"),[])))},o.controlMML=function(e){if(e.preventDefault(),X("mml").isSequences()){X("mml").get();o.paused?("oscillator"===o.$parent.currentSoundSource?(angular.forEach(n,function(e){X("oscillator",e).state(!0),C("oscillator",e).state(!0)}),o.$parent.oscillators.oscillator0.isActive=!0,o.$parent.oscillators.oscillator1.isActive=!0,0<X("mml").get().length&&X("mml").start(0),0<C("mml").get().length&&C("mml").start(0),X("mixer").module("recorder").start(),X("mixer").module("session").start()):(0<X("mml").get().length&&X("mml").start(0),0<C("mml").get().length&&C("mml").start(0),X("oneshot").module("recorder").start(),X("oneshot").module("session").start()),o.paused=!1):(X("mml").stop(),C("mml").stop(),angular.forEach(n,function(e){X("oscillator",e).state(!0),C("oscillator",e).state(!0)}),o.paused=!0)}},o.stopMML=function(e){X("mml").stop(),C("mml").stop(),o.mml=o.mml.replace(/<span class="highlight">/g,"").replace(/<\/span>/g,""),r[0].querySelector("[contentEditable]").textContent=o.mml,o.readyMML(),o.paused=!0,o.$parent.clearKeyboards()},o.downloadMML=function(e){if(0!==o.mml.trim().length){var a=o.mml.replace(/<span class="highlight">/g,"").replace(/<\/span>/g,"");o.dataURL=X.toTextFile(a),o.filename="mml-"+l()+".txt"}else e.preventDefault()}}]),e.controller("SessionController",["$scope","$location","$timeout","sources","openDialog",function(t,e,a,o,r){var s=!1,i="",n="";n=-1!==e.host().indexOf("localhost")?(s=!1,i="localhost",""):(s=!0,i="x-sound-server.herokuapp.com/","/app/websocket/");var l=function(e){r("Confirmation",800,"auto",!1,"<p><b>Connection to ("+e.currentTarget.url+") succeeded.</b></p>"),a(function(){t.isActive=!0})},c=function(e){r("Confirmation",400,"auto",!0,"<p><b>Connection closed.</b></p>"),a(function(){t.isActive=!1})},u=function(e){r("Error",400,"auto",!0,"<p><b>Server Error.</b></p>"),a(function(){t.isActive=!1})},p=function(){a(function(){t.$parent.isModalProgressSessionWait=!1,X("mixer").module("session").state()?t.isActive=!0:t.isActive=!1})},d=function(e){t.$parent.isModalProgressSessionWait=!0};t.isActive=!1,t.url="",t.toggleSessionState=function(e){if(t.isActive=!t.isActive,t.isActive)if(X("mixer").module("session").isConnected()&&X("oneshot").module("session").isConnected()&&X("audio").module("session").isConnected()&&X("stream").module("session").isConnected())angular.forEach(o,function(e){"oscillator"!==e&&X(e).module("session").state(!0,p,d)});else{var a={tls:s,host:i,port:8e3,path:n,open:l,close:c,error:u};try{angular.forEach(o,function(e){"oscillator"!==e&&(X(e).module("session").setup(a).state(!0,p,d),a.port++)})}catch(e){t.isActive=!1,r("Error",400,"auto",!0,"<p><b>"+e.message+"</b></p>")}}else angular.forEach(o,function(e){"oscillator"!==e&&X(e).module("session").state(!1,p,d)})}}]),e.controller("PatchController",["$rootScope","$scope","$http","$window","$location","$timeout","sources","openDialog","getCurrentPatches",function(e,M,o,a,t,k,y,r,S){var s=1e4,i=-1!==t.host().indexOf("localhost")?"http://localhost/~korilakkuma/portfolio-x-sound-server/php/bootstrap.php":"https://weblike-curtaincall.ssl-lolipop.jp/portfolio-x-sound-server/php/bootstrap.php",n=S(),l=function(e,a){if(angular.isObject(e)){var t=function(a,t){angular.forEach(y,function(e){X(e).module(a).state(t)}),C("oscillator").module(a).state(t),t?$('[effector="'+a+'"]').addClass("check-on"):$('[effector="'+a+'"]').removeClass("check-on")};if("mastervolume"in e&&$(".slider-mastervolume:not(:first)").slider("value",e.mastervolume),"glide"in e){var o=e.glide;"time"in o&&$(".slider-glide-time").slider("value",o.time)}if("envelopegenerator"in e){var r=e.envelopegenerator;"attack"in r&&$(".slider-envelopegenerator-attack").slider("value",r.attack),"decay"in r&&$(".slider-envelopegenerator-decay").slider("value",r.decay),"sustain"in r&&$(".slider-envelopegenerator-sustain").slider("value",r.sustain),"release"in r&&$(".slider-envelopegenerator-release").slider("value",r.release)}if("oscillator0"in e){var s=e.oscillator0;"state"in s&&k(function(){M.$parent.oscillators.oscillator0.isActive=!s,M.$parent.toggleOscillatorState(null,0)}),"type"in s&&k(function(){M.$parent.changeWaveType(null,0,s.type)}),"gain"in s&&$(".slider-volume:first").slider("value",s.gain),"octave"in s&&$(".slider-octave:first").slider("value",s.octave),"fine"in s&&$(".slider-fine:first").slider("value",s.fine)}if("oscillator1"in e){var i=e.oscillator1;"state"in i&&k(function(){M.$parent.oscillators.oscillator1.isActive=!i,M.$parent.toggleOscillatorState(null,1)}),"type"in i&&k(function(){M.$parent.changeWaveType(null,1,i.type)}),"gain"in i&&$(".slider-volume:last").slider("value",i.gain),"octave"in i&&$(".slider-octave:last").slider("value",i.octave),"fine"in i&&$(".slider-fine:last").slider("value",i.fine)}if("compressor"in e){var n=e.compressor;"state"in n&&t("compressor",n.state),"threshold"in n&&$(".slider-threshold").slider("value",n.threshold),"knee"in n&&$(".slider-knee").slider("value",n.knee),"ratio"in n&&$(".slider-ratio").slider("value",n.ratio),"attack"in n&&$(".slider-compressor-attack").slider("value",n.attack),"release"in n&&$(".slider-compressor-release").slider("value",n.release)}if("distortion"in e){var l=e.distortion;"state"in l&&t("distortion",l.state),"curve"in l&&$("#select-distortion-type").val(l.curve).trigger("change"),"samples"in l&&$("#select-distortion-sample").val("value",l.samples),"drive"in l&&$(".slider-distortion-drive").slider("value",l.drive),"color"in l&&$(".slider-distortion-color").slider("value",l.color),"tone"in l&&$(".slider-distortion-tone").slider("value",l.tone)}if("wah"in e){var c=e.wah;"state"in c&&t("wah",c.state),"cutoff"in c&&$(".slider-wah-cutoff").slider("value",c.cutoff),"depth"in c&&$(".slider-wah-depth").slider("value",c.depth),"rate"in c&&$(".slider-wah-rate").slider("value",c.rate),"resonance"in c&&$(".slider-wah-resonance").slider("value",c.resonance)}if("equalizer"in e){var u=e.equalizer;"state"in u&&t("equalizer",u.state),"bass"in u&&$(".slider-equalizer-bass").slider("value",u.bass),"middle"in u&&$(".slider-equalizer-middle").slider("value",u.middle),"treble"in u&&$(".slider-equalizer-treble").slider("value",u.treble),"presence"in u&&$(".slider-equalizer-presence").slider("value",u.presence)}if("filter"in e){var p=e.filter;"state"in p&&t("filter",p.state),"type"in p&&$("#select-filter-type").val(p.type).trigger("change"),"frequency"in p&&$(".slider-filter-cutoff").slider("value",p.frequency),"Q"in p&&$(".slider-filter-Q").slider("value",p.Q),"gain"in p&&$(".slider-filter-gain").slider("value",p.gain),"attack"in p&&$(".slider-filter-attack").slider("value",p.attack),"decay"in p&&$(".slider-filter-decay").slider("value",p.decay),"sustain"in p&&$(".slider-filter-sustain").slider("value",p.sustain),"release"in p&&$(".slider-filter-release").slider("value",p.release)}if("autopanner"in e){var d=e.autopanner;"state"in d&&t("autopanner",d.state),"depth"in d&&$(".slider-autopanner-depth").slider("value",d.depth),"rate"in d&&$(".slider-autopanner-rate").slider("value",d.rate)}if("tremolo"in e){var h=e.tremolo;"state"in h&&t("tremolo",h.state),"depth"in h&&$(".slider-tremolo-depth").slider("value",h.depth),"rate"in h&&$(".slider-tremolo-rate").slider("value",h.rate)}if("ringmodulator"in e){var m=e.ringmodulator;"state"in m&&t("ringmodulator",m.state),"depth"in m&&$(".slider-ringmodulator-depth").slider("value",m.depth),"rate"in m&&$(".slider-ringmodulator-rate").slider("value",m.rate)}if("phaser"in e){var f=e.phaser;"state"in f&&t("phaser",f.state),"stage"in f&&$(".select-phaser-stage").val(f.stage),"frequency"in f&&$(".slider-phaser-cutoff").slider("value",f.frequency),"depth"in f&&$(".slider-phaser-depth").slider("value",f.depth),"rate"in f&&$(".slider-phaser-rate").slider("value",f.rate),"mix"in f&&$(".slider-phaser-mix").slider("value",f.mix),"feedback"in f&&$(".slider-phaser-feedback").slider("value",f.feedback)}if("flanger"in e){var v=e.flanger;"state"in v&&t("flanger",v.state),"time"in v&&$(".slider-flanger-time").slider("value",v.time),"depth"in v&&$(".slider-flanger-depth").slider("value",v.depth),"rate"in v&&$(".slider-flanger-rate").slider("value",v.rate),"mix"in v&&$(".slider-flanger-mix").slider("value",v.mix),"tone"in v&&$(".slider-flanger-tone").slider("value",v.tone),"feedback"in v&&$(".slider-flanger-feedback").slider("value",v.feedback)}if("chorus"in e){var g=e.chorus;"state"in g&&t("chorus",g.state),"time"in g&&$(".slider-chorus-time").slider("value",g.time),"depth"in g&&$(".slider-chorus-depth").slider("value",g.depth),"rate"in g&&$(".slider-chorus-rate").slider("value",g.rate),"mix"in g&&$(".slider-chorus-mix").slider("value",g.mix),"tone"in g&&$(".slider-chorus-tone").slider("value",g.tone),"feedback"in g&&$(".slider-chorus-feedback").slider("value",g.feedback)}if("delay"in e){var w=e.delay;"state"in w&&t("delay",w.state),"time"in w&&$(".slider-delay-time").slider("value",w.time),"dry"in w&&$(".slider-delay-dry").slider("value",w.dry),"wet"in w&&$(".slider-delay-wet").slider("value",w.wet),"tone"in w&&$(".slider-delay-tone").slider("value",w.tone),"feedback"in w&&$(".slider-delay-feedback").slider("value",w.feedback)}if("reverb"in e){var b=e.reverb;"state"in b&&t("reverb",b.state),"dry"in b&&$(".slider-reverb-dry").slider("value",b.dry),"wet"in b&&$(".slider-reverb-wet").slider("value",b.wet),"tone"in b&&$(".slider-reverb-tone").slider("value",b.tone)}k(function(){M.currentPatches=S(),a&&history.pushState(S(),null)})}},c=function(){r("Error",500,"auto",!1,"<p><b>Connection to Server failed.</b></p>")};a.onpopstate=function(e){e.state?l(e.state,!1):l(n,!1)},M.isAuth=!1,M.isSignin=!0,M.isSignup=!1,M.isPatchList=!1,M.isSavePath=!1,M.isAccount=!1,M.isDisabled=!1,M.csrf="",M.signups={username:"",password:""},M.signins={username:"",password:""},M.deleteAccounts={username:"",password:""},M.authedUsername="",M.patchname="",M.patchLists=[],M.dialogPatchDetailId="dialog-patch-detail",M.isShowDialogPatchDetail=!1,M.$watch(function(){return M.isAuth},function(e){e?(M.signups={username:"",password:""},M.signins={username:"",password:""},M.currentPatches=S(),M.toggleAction(null,"patchList")):(M.deleteAccounts={username:"",password:""},M.currentPatches={},M.patches={},M.patchname="",M.patchLists=[],M.authedUsername="",M.isShowDialogPatchDetail=!1,M.toggleAction(null,"signin"))}),M.$on("onOpenPatchDialog",function(e){M.currentPatches=S()}),M.cancelClose=function(e){e.stopImmediatePropagation()},M.toggleAction=function(e,a){switch(null!==e&&e.preventDefault(),M.isSignin=!1,M.isSignup=!1,M.isPatchList=!1,M.isSavePatch=!1,M.isAccount=!1,a){case"signin":M.isSignin=!0;break;case"signup":M.isSignup=!0;break;case"patchList":M.isPatchList=!0;break;case"savePatch":M.isSavePatch=!0;break;case"account":M.isAccount=!0}},M.signin=function(e){e.preventDefault(),M.isDisabled=!0,o({method:"POST",url:i+"/account/signin",timeout:s,withCredentials:!0,params:"",data:{username:M.signins.username,password:M.signins.password,_csrf:M.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(M.csrf=a.csrf,M.isAuth=a.isAuth,M.authedUsername=a.username,M.patchLists=angular.fromJson(a.patches)),M.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(M.csrf=a.csrf,angular.forEach(a.message,function(e){r("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),M.isDisabled=!1})},M.signup=function(e){e.preventDefault(),M.isDisabled=!0,o({method:"POST",url:i+"/account/signup",timeout:s,withCredentials:!0,params:"",data:{username:M.signups.username,password:M.signups.password,_csrf:M.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(M.csrf=a.csrf,M.isAuth=a.isAuth,M.authedUsername=a.username,angular.forEach(a.message,function(e){r("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")})),M.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(M.csrf=a.csrf,angular.forEach(a.message,function(e){r("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),M.isDisabled=!1})},M.signout=function(e){M.isDisabled=!0,o({method:"POST",url:i+"/account/signout",timeout:s,withCredentials:!0,params:"",data:{_csrf:M.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(M.csrf=a.csrf,angular.forEach(a.message,function(e){r("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")})),M.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(M.csrf=a.csrf,angular.forEach(a.message,function(e){r("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),M.isDisabled=!1})},M.deleteAccount=function(e){$("<div />").html('<p><b>Delete your account. OK ?<br /> <b class="dangerous">If you delete account, the all of patches that you saved are also deleted.</b></b></p>').dialog({title:"Confirmation",autoOpen:!0,show:"bounce",hide:"explode",modal:!1,width:650,height:"auto",draggable:!0,resizable:!1,zIndex:9999,buttons:{OK:function(){M.isDisabled=!0,o({method:"POST",url:i+"/account/delete",timeout:s,withCredentials:!0,params:"",data:{username:M.deleteAccounts.username,password:M.deleteAccounts.password,_csrf:M.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(M.csrf=a.csrf,M.isAuth=a.isAuth,M.authedUsername=a.username,M.isAuth||angular.forEach(a.message,function(e){r("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")})),M.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(M.csrf=a.csrf,angular.forEach(a.message,function(e){r("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),M.isDisabled=!1}),$(this).dialog("close").dialog("destroy").remove()},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},M.typePatchname=function(e){M.patchname=e.currentTarget.value},M.savePatch=function(e){M.isDisabled=!0,o({method:"POST",url:i+"/patch/add",timeout:s,withCredentials:!0,params:"",data:{name:M.patchname,patch:angular.toJson(S()),_csrf:M.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(M.csrf=a.csrf,M.isAuth=a.isAuth,M.patchLists=angular.fromJson(a.patches),angular.forEach(a.message,function(e){r("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")})),M.isDisabled=!1}).catch(function(e){var a=e.data;angular.isObject(a)?(M.csrf=a.csrf,M.isAuth=a.isAuth,angular.forEach(a.message,function(e){r("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c(),M.isDisabled=!1})},M.openPatchDetail=function(e,a){if(angular.isObject(a)&&angular.isObject(a.patch))M.patches=a.patch;else{if(!angular.isString(a.patch))return;var t=a.patch.replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&");M.patches=angular.fromJson(t)}M.isShowDialogPatchDetail=!0,$("#"+M.dialogPatchDetailId).dialog({title:a.name,autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:600,height:400,draggable:!0,resizable:!1,zIndex:9999,position:{my:"center top",at:"center top"},buttons:{LOAD:function(){l(M.patches,!0),$(this).dialog("close")},UPDATE:function(){$("<div />").html("<p><b>Update the patch. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:1e4,buttons:{OK:function(){var e;e=a.name,o({method:"POST",url:i+"/patch/update",timeout:s,withCredentials:!0,params:"",data:{name:e,patch:angular.toJson(S()),_csrf:M.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(M.csrf=a.csrf,M.isAuth=a.isAuth,M.patchLists=angular.fromJson(a.patches),angular.forEach(a.message,function(e){r("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")}))}).catch(function(e){var a=e.data;angular.isObject(a)?(M.csrf=a.csrf,M.isAuth=a.isAuth,angular.forEach(a.message,function(e){r("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c()}),$(this).dialog("close").dialog("destroy").remove(),$("#"+M.dialogPatchDetailId).dialog("close")},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},DELETE:function(){$("<div />").html("<p><b>Delete the patch. OK ?</b></p>").dialog({title:"Confirmation",autoOpen:!0,show:"explode",hide:"explode",modal:!1,width:400,height:"auto",draggable:!0,resizable:!1,zIndex:1e4,buttons:{OK:function(){var e;e=a.name,o({method:"POST",url:i+"/patch/delete",timeout:s,withCredentials:!0,params:"",data:{name:e,_csrf:M.csrf},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return $.param(e)}}).then(function(e){var a=e.data;angular.isObject(a)&&(M.csrf=a.csrf,M.isAuth=a.isAuth,M.patchLists=angular.fromJson(a.patches),angular.forEach(a.message,function(e){r("Confirmation",500,"auto",!1,"<p><b>"+e+"</b></p>")}))}).catch(function(e){var a=e.data;angular.isObject(a)?(M.csrf=a.csrf,M.isAuth=a.isAuth,angular.forEach(a.message,function(e){r("Error",500,"auto",!1,"<p><b>"+e+"</b></p>")})):c()}),$(this).dialog("close").dialog("destroy").remove(),$("#"+M.dialogPatchDetailId).dialog("close")},CANCEL:function(){$(this).dialog("close").dialog("destroy").remove()}}})},CLOSE:function(){$(this).dialog("close")}},close:function(e,a){$(this).dialog("destroy"),k(function(){M.isShowDialogPatchDetail=!1})}})},o({method:"GET",url:i,timeout:s,withCredentials:!0,params:"",headers:{}}).then(function(e){var a=e.data;angular.isObject(a)&&(M.isAuth=a.isAuth,M.authedUsername=a.username,M.csrf=a.csrf,M.isAuth&&(M.patchLists=angular.fromJson(a.patches)))}).catch(function(e){c()})}])}();
//# sourceMappingURL=controller.min.js.map
